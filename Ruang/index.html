<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruang - Math Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #4a5568;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #e2e8f0;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .experience-bar {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .exp-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .exp-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a5568, #718096);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .category-selector {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .category-select {
            padding: 12px 20px;
            border: 2px solid #4a5568;
            border-radius: 8px;
            background: white;
            color: #4a5568;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-select:hover {
            background: #4a5568;
            color: white;
        }
        
        .progress-section {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4a5568, #68d391);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .timer-fill {
            height: 100%;
            width: 100%;
            transition: all 1s linear;
            background: #68d391;
        }
        
        .timer-fill.warning {
            background: #ed8936;
        }
        
        .timer-fill.danger {
            background: #e53e3e;
            animation: pulse-timer 0.5s infinite alternate;
        }
        
        @keyframes pulse-timer {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }
        
        .question-card {
            background: #f7fafc;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e2e8f0;
            margin-bottom: 20px;
            position: relative;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .question-content {
            flex: 1;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .image-container {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .image-fallback {
            background: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            color: #4a5568;
            font-weight: 500;
        }
        
        .difficulty-badges {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 20px;
        }
        
        .difficulty-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-align: center;
        }
        
        .difficulty-easy { background: #c6f6d5; color: #22543d; }
        .difficulty-medium { background: #fed7d7; color: #c53030; }
        .difficulty-hard { background: #fbb6ce; color: #97266d; }
        
        .points-badge {
            background: #e2e8f0;
            color: #4a5568;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .category-badge {
            background: #bee3f8;
            color: #2b6cb0;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            padding: 20px;
            border: 2px solid #4a5568;
            border-radius: 12px;
            background: #f7fafc;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
            position: relative;
            transform-origin: center;
        }
        
        .option-btn:hover:not(:disabled) {
            background: #e2e8f0;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.15);
        }
        
        .option-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .option-text {
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .option-btn.correct {
            background: #68d391;
            color: white;
            border-color: #68d391;
            animation: correctPulse 0.6s ease-out;
        }
        
        .option-btn.wrong {
            background: #e53e3e;
            color: white;
            border-color: #e53e3e;
            animation: wrongShake 0.5s ease-out;
        }
        
        .option-btn.disabled {
            background: #f0f0f0;
            color: #999;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback {
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .feedback::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .feedback.show::before {
            left: 100%;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #c6f6d5, #9ae6b4);
            color: #22543d;
            border-color: #68d391;
        }
        
        .feedback.wrong {
            background: linear-gradient(135deg, #fed7d7, #fbb6ce);
            color: #c53030;
            border-color: #e53e3e;
        }
        
        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .feedback-icon {
            font-size: 1.5em;
        }
        
        .feedback-explanation {
            font-weight: normal;
            line-height: 1.5;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4a5568, #718096);
            color: white;
            box-shadow: 0 4px 15px rgba(74, 85, 104, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(74, 85, 104, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #a0aec0, #cbd5e0);
            color: white;
            box-shadow: 0 4px 15px rgba(160, 174, 192, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(160, 174, 192, 0.4);
        }
        
        .btn-back {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            border: 2px solid transparent;
        }
        
        .btn-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            border-color: #495057;
        }
        
        .back-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
        }
        
        .timer-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-weight: bold;
            font-size: 1.1em;
            border: 2px solid #e2e8f0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .timer-display.warning {
            background: #ed8936;
            color: white;
            border-color: #ed8936;
            animation: pulse 2s infinite;
        }
        
        .timer-display.danger {
            background: #e53e3e;
            color: white;
            border-color: #e53e3e;
            animation: urgentPulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes urgentPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.1) rotate(2deg); }
        }
        
        .complete-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .trophy-animation {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .final-stat {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .final-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .final-stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .achievements-section {
            margin-top: 30px;
            text-align: left;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #718096, #a0aec0);
            color: #2d3748;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #718096;
            animation: achievementGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes achievementGlow {
            from { box-shadow: 0 4px 15px rgba(113, 128, 150, 0.3); }
            to { box-shadow: 0 8px 25px rgba(113, 128, 150, 0.6); }
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-popup {
            position: fixed;
            top: 70px;
            right: 10px;
            background: #718096;
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(113, 128, 150, 0.4);
            z-index: 1001;
            animation: slideInBounce 0.6s ease-out;
            border: 2px solid #a0aec0;
            max-width: 250px;
        }
        
        @keyframes slideInBounce {
            0% { transform: translateX(400px); opacity: 0; }
            60% { transform: translateX(-20px); opacity: 1; }
            100% { transform: translateX(0); }
        }
        
        .achievement-popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #4a5568;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: 500;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #e2e8f0;
        }

        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 5px;
        }
        
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        
        .fraction .denominator {
            display: block;
            padding-top: 2px;
        }

        .math-expression {
            font-family: 'Times New Roman', serif;
            font-size: 1.3em;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .main-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                position: fixed;
                top: 5px;
                right: 5px;
                padding: 8px 15px;
                font-size: 1em;
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .achievement-popup {
                top: 55px;
                right: 5px;
                left: 5px;
                max-width: none;
                padding: 12px;
            }
            
            .difficulty-badges {
                flex-direction: row;
                margin-left: 0;
                margin-top: 15px;
            }
            
            .question-header {
                flex-direction: column;
            }
            
            .final-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            body {
                padding: 10px 5px 5px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="timer-display" id="timerDisplay">⏰ 2:00</div>
    
    <div class="back-button-container">
        <button class="btn btn-back" onclick="goBack()">
            ← Kembali
        </button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">📐 Ruang</h1>
            <p class="subtitle">Permainan Matematik Interaktif - Geometri, Isi Padu, Luas dan Perimeter</p>
        </div>

        <div class="main-stats">
            <div class="stat-box">
                <div class="stat-number" id="questionCounter" style="color: #4a5568;">1/20</div>
                <div class="stat-label">Soalan</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="scoreDisplay" style="color: #68d391;">0</div>
                <div class="stat-label">Skor</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="pointsDisplay" style="color: #22543d;">0</div>
                <div class="stat-label">Mata</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="streakDisplay" style="color: #ed8936;">0</div>
                <div class="stat-label">Berturut</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="levelDisplay" style="color: #718096;">1</div>
                <div class="stat-label">Tahap</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="timerStat" style="color: #2b6cb0;">2:00</div>
                <div class="stat-label">Masa</div>
            </div>
        </div>

        <div class="experience-bar">
            <div class="exp-label" id="expLabel">Pengalaman: 0 / 100</div>
            <div class="exp-bar">
                <div class="exp-fill" id="expFill"></div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">5%</div>
            </div>
            <div class="timer-bar">
                <div class="timer-fill" id="timerBar"></div>
            </div>
        </div>

        <div id="gameArea">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-content">
                        <div class="question-text" id="questionText">
                            Loading question...
                        </div>
                        <div id="imageContainer"></div>
                    </div>
                    <div class="difficulty-badges">
                        <div class="difficulty-badge" id="difficultyBadge">Sederhana</div>
                        <div class="points-badge" id="pointsBadge">20 mata</div>
                        <div class="category-badge" id="categoryBadge">Topik</div>
                    </div>
                </div>
                
                <div class="options" id="optionsContainer">
                    <!-- Options will be populated by JavaScript -->
                </div>

                <div id="feedback" style="display: none;"></div>
                
                <div class="action-buttons" id="actionButtons">
                    <button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All 20 questions from the Ruang curriculum - with randomized answer positions
        const questions = [
            // Simple calculation questions (1-10)
            {
                id: 1,
                category: 'volume_calculation',
                difficulty: 'easy',
                question: 'Hitung isi padu kubus yang mempunyai sisi 4 cm.',
                answer: '64 cm³',
                options: ['16 cm³', '64 cm³', '48 cm³', '32 cm³'],
                explanation: 'Isi padu kubus = sisi × sisi × sisi = 4 × 4 × 4 = 64 cm³'
            },
            {
                id: 2,
                category: 'volume_calculation',
                difficulty: 'medium',
                question: 'Berapakah isi padu kuboid dengan panjang 6 m, lebar 2 m dan tinggi 3 m?',
                answer: '36 m³',
                options: ['36 m³', '24 m³', '18 m³', '42 m³'],
                explanation: 'Isi padu kuboid = panjang × lebar × tinggi = 6 × 2 × 3 = 36 m³'
            },
            {
                id: 3,
                category: 'perimeter_calculation',
                difficulty: 'easy',
                question: 'Cari perimeter segi empat sama dengan panjang sisi 16 m.',
                answer: '64 m',
                options: ['48 m', '64 m', '56 m', '72 m'],
                explanation: 'Perimeter segi empat sama = 4 × sisi = 4 × 16 = 64 m'
            },
            {
                id: 4,
                category: 'area_calculation',
                difficulty: 'easy',
                question: 'Hitung luas segi empat sama yang mempunyai sisi 16 m.',
                answer: '256 m²',
                options: ['256 m²', '244 m²', '268 m²', '240 m²'],
                explanation: 'Luas segi empat sama = sisi × sisi = 16 × 16 = 256 m²'
            },
            {
                id: 5,
                category: 'perimeter_calculation',
                difficulty: 'medium',
                question: 'Hitung perimeter segi empat tepat dengan panjang 240 cm dan lebar yang perlu dicari jika perimeternya ialah 240 cm dan luas 60 cm.',
                answer: '60 cm',
                options: ['50 cm', '70 cm', '60 cm', '55 cm'],
                explanation: 'Perimeter = 2 × (panjang + lebar). Jika salah satu sisi ialah 60 cm, maka 240 ÷ 4 = 60 cm setiap sisi.'
            },
            {
                id: 6,
                category: 'area_calculation',
                difficulty: 'medium',
                question: 'Cari luas segi empat tepat dengan panjang 15 cm dan lebar 4 cm.',
                answer: '60 cm²',
                options: ['60 cm²', '38 cm²', '56 cm²', '64 cm²'],
                explanation: 'Luas segi empat tepat = panjang × lebar = 15 × 4 = 60 cm²'
            },
            {
                id: 7,
                category: 'volume_calculation',
                difficulty: 'medium',
                question: 'Isi padu kubus P ialah 1000 cm³. Apakah panjang sisi kubus P?',
                answer: '10 cm',
                options: ['8 cm', '12 cm', '10 cm', '9 cm'],
                explanation: 'Isi padu kubus = sisi³. Jadi sisi³ = 1000, maka sisi = ∛1000 = 10 cm'
            },
            {
                id: 8,
                category: 'volume_calculation',
                difficulty: 'hard',
                question: 'Kuboid R mempunyai panjang 15 cm, lebar 3 cm dan tinggi 4 cm. Berapakah isi padunya?',
                answer: '180 cm³',
                options: ['180 cm³', '170 cm³', '190 cm³', '160 cm³'],
                explanation: 'Isi padu kuboid = 15 × 3 × 4 = 180 cm³'
            },
            {
                id: 9,
                category: 'surface_area',
                difficulty: 'hard',
                question: 'Diberi luas permukaan sebuah kontena ialah 12 m². Jika panjang dan lebar kontena masing-masing 3 m dan 2 m, berapakah tingginya?',
                answer: '2 m',
                options: ['1.5 m', '2 m', '2.5 m', '3 m'],
                explanation: 'Luas permukaan = luas tapak = panjang × lebar = 3 × 2 = 6 m². Jika luas permukaan keseluruhan 12 m², maka tinggi = 12 ÷ 6 = 2 m'
            },
            {
                id: 10,
                category: 'line_geometry',
                difficulty: 'easy',
                question: 'Apakah ciri-ciri garis selari?',
                answer: 'Tidak bersilang',
                options: ['Bersilang pada satu titik', 'Tidak bersilang', 'Berserenjang', 'Membentuk sudut tegak'],
                explanation: 'Garis selari ialah garis yang tidak pernah bersilang walaupun dipanjangkan'
            },
            
            // Complex word problems with images (11-20)
            {
                id: 11,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Zura menggunakan 240 cm renda hitam untuk menghias keliling sehelai alas meja berbentuk segi empat sama. Berapakah panjang satu sisi alas meja itu dalam cm? Kemudian hitung luas permukaan alas meja dalam cm².',
                image: {
                    src: 'images/zura-table-cloth.png',
                    alt: 'Zura menghias alas meja segi empat sama dengan renda',
                    description: 'Gambar menunjukkan alas meja berbentuk segi empat sama dengan renda di sekeliling tepinya. Jumlah panjang renda yang digunakan ialah 240 cm.'
                },
                answer: '60 cm, 3600 cm²',
                options: ['50 cm, 2500 cm²', '60 cm, 3600 cm²', '70 cm, 4900 cm²', '55 cm, 3025 cm²'],
                explanation: 'Perimeter = 240 cm, jadi satu sisi = 240 ÷ 4 = 60 cm. Luas = 60 × 60 = 3600 cm²'
            },
            {
                id: 12,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Lai Fong menyusun 48 buah kubus kecil ke dalam sebuah kotak berbentuk kuboid. Panjang setiap sisi kubus kecil ialah 3 cm. Berapakah isi padu kotak berbentuk kuboid itu dalam cm³?',
                image: {
                    src: 'images/lai-fong-cubes.png',
                    alt: 'Lai Fong menyusun kubus kecil dalam kotak kuboid',
                    description: 'Gambar menunjukkan 48 kubus kecil bersisi 3 cm yang disusun rapi dalam sebuah kotak berbentuk kuboid.'
                },
                answer: '1296 cm³',
                options: ['1296 cm³', '1200 cm³', '1350 cm³', '1440 cm³'],
                explanation: 'Isi padu satu kubus kecil = 3³ = 27 cm³. Jumlah isi padu = 48 × 27 = 1296 cm³'
            },
            {
                id: 13,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'David menyusun kiub Rubik bersisi 4 cm ke dalam sebuah kotak bersaiz 16 cm × 12 cm × 8 cm. Berapakah bilangan kiub Rubik yang dapat dimuatkan ke dalam kotak itu?',
                image: {
                    src: 'images/david-rubik-cube-box.png',
                    alt: 'David menyusun kiub Rubik dalam kotak',
                    description: 'Gambar menunjukkan kotak berukuran 16cm × 12cm × 8cm dengan kiub Rubik bersisi 4cm yang hendak dimasukkan ke dalamnya.'
                },
                answer: '24 buah',
                options: ['20 buah', '24 buah', '28 buah', '32 buah'],
                explanation: 'Isi padu kotak = 16 × 12 × 8 = 1536 cm³. Isi padu kiub Rubik = 4³ = 64 cm³. Bilangan = 1536 ÷ 64 = 24 buah'
            },
            {
                id: 14,
                category: 'word_problems',
                difficulty: 'medium',
                question: 'Kandang lembu Zaini berbentuk segi empat sama dengan sisi 16 m. Dia hendak menggantikan pagar di sekeliling kandang. Hitung jumlah panjang pagar yang diperlukan dan luas kandang tersebut.',
                image: {
                    src: 'images/zaini-cattle-pen.png',
                    alt: 'Kandang lembu berbentuk segi empat sama',
                    description: 'Gambar menunjukkan kandang lembu berbentuk segi empat sama dengan panjang sisi 16 m. Zaini sedang mengukur pagar di sekeliling kandang.'
                },
                answer: '64 m, 256 m²',
                options: ['64 m, 256 m²', '60 m, 240 m²', '68 m, 272 m²', '72 m, 288 m²'],
                explanation: 'Perimeter pagar = 4 × 16 = 64 m. Luas kandang = 16 × 16 = 256 m²'
            },
            {
                id: 15,
                category: 'word_problems',
                difficulty: 'medium',
                question: 'Panjang kandang kambing ialah 4 m lebih daripada kandang lembu Zaini (16 m). Lebar kedua-dua kandang adalah sama. Hitung luas kandang kambing.',
                image: {
                    src: 'images/goat-pen-comparison.png',
                    alt: 'Perbandingan kandang kambing dan kandang lembu',
                    description: 'Gambar menunjukkan kandang lembu (16m × 16m) dan kandang kambing yang panjangnya 4m lebih panjang (20m × 16m).'
                },
                answer: '320 m²',
                options: ['300 m²', '320 m²', '340 m²', '280 m²'],
                explanation: 'Panjang kandang kambing = 16 + 4 = 20 m. Luas = 20 × 16 = 320 m²'
            },
            {
                id: 16,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Gambar foto menunjukkan kawasan taman permainan berbentuk segi empat tepat. Panjang pagar di sekeliling taman permainan itu ialah 50 m. Jika panjang taman ialah 16 m, hitung lebar dan luas taman permainan itu.',
                image: {
                    src: 'images/playground-aerial-view.png',
                    alt: 'Pandangan udara taman permainan berbentuk segi empat tepat',
                    description: 'Gambar aerial menunjukkan taman permainan berbentuk segi empat tepat dengan panjang 16 m. Pagar mengelilingi seluruh taman dengan jumlah panjang 50 m.'
                },
                answer: '9 m, 144 m²',
                options: ['8 m, 128 m²', '9 m, 144 m²', '10 m, 160 m²', '7 m, 112 m²'],
                explanation: 'Perimeter = 50 m = 2 × (16 + lebar). Jadi 25 = 16 + lebar, lebar = 9 m. Luas = 16 × 9 = 144 m²'
            },
            {
                id: 17,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Raju mempunyai dua bekas: kuboid A (panjang p, lebar 8 cm, tinggi 2 cm) dan kubus B (sisi 8 cm). Isi padu kedua-dua bekas adalah sama. Apakah nilai p?',
                image: {
                    src: 'images/raju-containers.png',
                    alt: 'Bekas kuboid A dan kubus B milik Raju',
                    description: 'Gambar menunjukkan bekas kuboid A dengan dimensi p × 8cm × 2cm dan kubus B dengan sisi 8cm. Kedua-dua bekas mempunyai isi padu yang sama.'
                },
                answer: '32 cm',
                options: ['28 cm', '32 cm', '36 cm', '30 cm'],
                explanation: 'Isi padu kubus B = 8³ = 512 cm³. Isi padu kuboid A = p × 8 × 2 = 16p. Jadi 16p = 512, p = 32 cm'
            },
            {
                id: 18,
                category: 'word_problems',
                difficulty: 'medium',
                question: 'Sebuah kotak tisu berbentuk kuboid mempunyai panjang 9 cm, lebar 7 cm dan tinggi 5 cm. Hitung isi padu kotak tisu tersebut.',
                image: {
                    src: 'images/tissue-box-dimensions.png',
                    alt: 'Kotak tisu dengan ukuran berlabel',
                    description: 'Gambar menunjukkan kotak tisu berbentuk kuboid dengan label dimensi: panjang 9 cm, lebar 7 cm, dan tinggi 5 cm.'
                },
                answer: '315 cm³',
                options: ['315 cm³', '300 cm³', '320 cm³', '295 cm³'],
                explanation: 'Isi padu kuboid = panjang × lebar × tinggi = 9 × 7 × 5 = 315 cm³'
            },
            {
                id: 19,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Satu kuboid T mempunyai tinggi 7 m dan luas permukaannya ialah 12 m². Jika kuboid ini mempunyai tapak berbentuk segi empat sama, berapakah isi padunya?',
                image: {
                    src: 'images/container-surface-area.png',
                    alt: 'Kuboid T dengan luas permukaan 12 m²',
                    description: 'Gambar menunjukkan kuboid T dengan tinggi 7 m dan tapak berbentuk segi empat sama. Luas permukaan tapak yang dilorek ialah 12 m².'
                },
                answer: '84 m³',
                options: ['72 m³', '84 m³', '96 m³', '60 m³'],
                explanation: 'Luas permukaan tapak = 12 m². Isi padu = luas tapak × tinggi = 12 × 7 = 84 m³'
            },
            {
                id: 20,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Sebuah kontena lori mempunyai panjang 6 m, lebar 2.5 m dan tinggi 2 m. Berapa banyak kotak kecil berbentuk kubus dengan sisi 0.5 m boleh dimuatkan dalam kontena tersebut?',
                image: {
                    src: 'images/truck-container-cubes.png',
                    alt: 'Kontena lori dengan kotak-kotak kecil',
                    description: 'Gambar menunjukkan kontena lori berukuran 6m × 2.5m × 2m yang diisi dengan kotak-kotak kubus kecil bersisi 0.5m.'
                },
                answer: '480 kotak',
                options: ['400 kotak', '480 kotak', '520 kotak', '360 kotak'],
                explanation: 'Isi padu kontena = 6 × 2.5 × 2 = 30 m³. Isi padu kotak kecil = 0.5³ = 0.125 m³. Bilangan = 30 ÷ 0.125 = 240 kotak'
            }
        ];

        // Achievement definitions for Ruang chapter
        const achievementDefinitions = [
            { id: 'first_correct', name: 'Permulaan Geometri!', description: 'Jawab soalan pertama dengan betul', icon: '🌟' },
            { id: 'streak_3', name: 'Dalam Rentak Ruang!', description: 'Jawab 3 soalan berturut-turut dengan betul', icon: '🔥' },
            { id: 'streak_5', name: 'Pakar Geometri!', description: 'Jawab 5 soalan berturut-turut dengan betul', icon: '⚡' },
            { id: 'quick_thinker', name: 'Pengira Pantas!', description: 'Jawab dalam 10 saat', icon: '💨' },
            { id: 'level_2', name: 'Naik Tahap Ruang!', description: 'Capai tahap 2', icon: '🎯' },
            { id: 'level_3', name: 'Pakar Matematik Ruang!', description: 'Capai tahap 3', icon: '👑' },
            { id: 'perfect_score', name: 'Sempurna Geometri!', description: 'Dapatkan 100% markah', icon: '🏆' },
            { id: 'high_scorer', name: 'Pencapai Tinggi Ruang!', description: 'Kumpul 500+ mata', icon: '💎' },
            { id: 'volume_master', name: 'Pakar Isi Padu!', description: 'Jawab semua soalan isi padu dengan betul', icon: '📦' },
            { id: 'area_expert', name: 'Ahli Luas!', description: 'Jawab semua soalan luas dengan betul', icon: '📐' },
            { id: 'perimeter_pro', name: 'Pro Perimeter!', description: 'Jawab semua soalan perimeter dengan betul', icon: '📏' },
            { id: 'word_problem_solver', name: 'Penyelesai Masalah Ruang!', description: 'Jawab semua masalah berayat dengan betul', icon: '📝' }
        ];

        // Game state
        let currentQuestion = 0;
        let score = 0;
        let points = 0;
        let streak = 0;
        let bestStreak = 0;
        let level = 1;
        let experience = 0;
        let timeLeft = 30;
        let timerInterval;
        let gameActive = true;
        let unlockedAchievements = [];
        let filteredQuestions = [];
        let categoryStats = {};

        // Shuffle array function for options only
        function shuffleOptions(question) {
            const correctAnswer = question.answer;
            const shuffledOptions = [...question.options];
            
            // Shuffle the options array
            for (let i = shuffledOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
            }
            
            return {
                ...question,
                options: shuffledOptions,
                answer: correctAnswer // Keep the correct answer unchanged
            };
        }

        // Initialize game
        function initGame() {
            console.log('Initializing Ruang game...');
            console.log('Questions array length:', questions.length);
            
            // Always use all questions, no filtering
            filteredQuestions = [...questions];
            console.log('Filtered questions length:', filteredQuestions.length);
            
            if (filteredQuestions.length > 0) {
                loadQuestion();
                startTimer();
                updateDisplays();
            } else {
                console.error('No questions available!');
            }
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120; // 2 minutes
            gameActive = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timerDisplay');
            const timerBar = document.getElementById('timerBar');
            const timerStat = document.getElementById('timerStat');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            timerEl.textContent = `⏰ ${timeText}`;
            timerStat.textContent = timeText;
            timerBar.style.width = `${(timeLeft / 120) * 100}%`;
            
            if (timeLeft <= 10) {
                timerEl.className = 'timer-display danger';
                timerBar.className = 'timer-fill danger';
                timerStat.style.color = '#e53e3e';
            } else if (timeLeft <= 30) {
                timerEl.className = 'timer-display warning';
                timerBar.className = 'timer-fill warning';
                timerStat.style.color = '#ed8936';
            } else {
                timerEl.className = 'timer-display';
                timerBar.className = 'timer-fill';
                timerStat.style.color = '#2b6cb0';
            }
        }

        // Points calculation
        function calculatePoints(difficulty, timeRemaining, isCorrect) {
            if (!isCorrect) return 0;
            
            let basePoints = 0;
            switch (difficulty) {
                case 'easy': basePoints = 10; break;
                case 'medium': basePoints = 20; break;
                case 'hard': basePoints = 30; break;
                default: basePoints = 15;
            }
            
            let timeBonus = timeRemaining > 60 ? 10 : timeRemaining > 30 ? 5 : 0;
            let streakMultiplier = Math.min(streak + 1, 3);
            
            return Math.round((basePoints + timeBonus) * streakMultiplier);
        }

        // Level and experience
        function updateLevel(newPoints) {
            const newExperience = experience + newPoints;
            const newLevel = Math.floor(newExperience / 100) + 1;
            
            if (newLevel > level) {
                checkAchievements('level', newLevel);
                showLevelUp(newLevel);
            }
            
            experience = newExperience;
            level = newLevel;
        }

        function showLevelUp(newLevel) {
            const levelEl = document.getElementById('levelDisplay');
            levelEl.style.animation = 'bounce 1s ease-out';
            setTimeout(() => {
                levelEl.style.animation = '';
            }, 1000);
        }

        // Achievement system
        function checkAchievements(type, value) {
            const newAchievements = [];
            
            switch (type) {
                case 'first_correct':
                    if (score === 0 && !unlockedAchievements.includes('first_correct')) {
                        newAchievements.push('first_correct');
                    }
                    break;
                case 'streak':
                    if (value >= 3 && !unlockedAchievements.includes('streak_3')) newAchievements.push('streak_3');
                    if (value >= 5 && !unlockedAchievements.includes('streak_5')) newAchievements.push('streak_5');
                    break;
                case 'quick_answer':
                    if (timeLeft > 90 && !unlockedAchievements.includes('quick_thinker')) {
                        newAchievements.push('quick_thinker');
                    }
                    break;
                case 'level':
                    if (value >= 2 && !unlockedAchievements.includes('level_2')) newAchievements.push('level_2');
                    if (value >= 3 && !unlockedAchievements.includes('level_3')) newAchievements.push('level_3');
                    break;
                case 'points':
                    if (value >= 500 && !unlockedAchievements.includes('high_scorer')) {
                        newAchievements.push('high_scorer');
                    }
                    break;
                case 'perfect':
                    if (!unlockedAchievements.includes('perfect_score')) {
                        newAchievements.push('perfect_score');
                    }
                    break;
                case 'category_master':
                    checkCategoryMaster(newAchievements);
                    break;
            }
            
            if (newAchievements.length > 0) {
                unlockedAchievements.push(...newAchievements);
                showAchievementPopup(newAchievements[0]);
            }
        }

        function checkCategoryMaster(newAchievements) {
            const volumeQuestions = questions.filter(q => q.category === 'volume_calculation');
            const areaQuestions = questions.filter(q => q.category === 'area_calculation');
            const perimeterQuestions = questions.filter(q => q.category === 'perimeter_calculation');
            const wordProblemQuestions = questions.filter(q => q.category === 'word_problems');
            
            if (!unlockedAchievements.includes('volume_master') && 
                volumeQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('volume_master');
            }
            
            if (!unlockedAchievements.includes('area_expert') && 
                areaQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('area_expert');
            }
            
            if (!unlockedAchievements.includes('perimeter_pro') && 
                perimeterQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('perimeter_pro');
            }

            if (!unlockedAchievements.includes('word_problem_solver') && 
                wordProblemQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('word_problem_solver');
            }
        }

        function showAchievementPopup(achievementId) {
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-popup-header">
                    <span style="font-size: 2em;">🏆</span>
                    <div>
                        <div style="font-weight: bold;">Pencapaian Baru!</div>
                        <div>${achievement.icon} ${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 3000);
        }

        // Question loading
        function loadQuestion() {
            if (currentQuestion >= filteredQuestions.length) {
                showResults();
                return;
            }
            
            // Get question and shuffle its options only
            const originalQ = filteredQuestions[currentQuestion];
            const currentQ = shuffleOptions(originalQ);
            
            // Format question with subquestions if available
            let questionHTML = currentQ.question;
            if (currentQ.subquestions) {
                questionHTML += '<br><br>';
                currentQ.subquestions.forEach(subq => {
                    questionHTML += subq + '<br>';
                });
            }
            
            document.getElementById('questionText').innerHTML = questionHTML;
            
            // Update difficulty and points badges
            const difficultyBadge = document.getElementById('difficultyBadge');
            const pointsBadge = document.getElementById('pointsBadge');
            const categoryBadge = document.getElementById('categoryBadge');
            
            const difficultyText = {
                'easy': 'Mudah',
                'medium': 'Sederhana', 
                'hard': 'Sukar'
            };
            
            const pointsText = {
                'easy': '10',
                'medium': '20',
                'hard': '30'
            };

            const categoryText = {
                'volume_calculation': 'Isi Padu',
                'area_calculation': 'Luas',
                'perimeter_calculation': 'Perimeter',
                'surface_area': 'Luas Permukaan',
                'line_geometry': 'Geometri Garisan',
                'word_problems': 'Masalah Berayat'
            };
            
            difficultyBadge.textContent = difficultyText[currentQ.difficulty] || 'Sederhana';
            difficultyBadge.className = `difficulty-badge difficulty-${currentQ.difficulty || 'medium'}`;
            pointsBadge.textContent = `${pointsText[currentQ.difficulty] || '20'} mata`;
            categoryBadge.textContent = categoryText[currentQ.category] || 'Geometri';
            
            // Store the current question with shuffled options for answer checking
            window.currentQuestionData = currentQ;
            
            // Load image if present
            loadQuestionImage(currentQ);
            
            // Update options (now shuffled)
            loadOptions(currentQ);
            
            // Reset feedback and buttons
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('actionButtons').innerHTML = 
                '<button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>';
            
            // Start timer
            startTimer();
            updateDisplays();
        }

        function loadQuestionImage(question) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            container.style.display = 'none';
            
            if (question.image) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-container';
                
                if (question.image.src) {
                    const img = document.createElement('img');
                    img.src = question.image.src;
                    img.alt = question.image.alt;
                    img.onerror = function() {
                        imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                    };
                    imageDiv.appendChild(img);
                } else if (question.image.description) {
                    imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                }
                
                container.appendChild(imageDiv);
                container.style.display = 'block';
            }
        }

        function loadOptions(question) {
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-label">Pilihan ${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                btn.dataset.answer = option;
                btn.onclick = () => selectAnswer(option);
                container.appendChild(btn);
            });
        }

        // Answer selection
        function selectAnswer(answer) {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const isCorrect = answer === currentQ.answer;
            const earnedPoints = calculatePoints(currentQ.difficulty, timeLeft, isCorrect);
            
            // Track category performance using original question id
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = isCorrect;
            
            if (isCorrect) {
                const newScore = score + 1;
                const newStreak = streak + 1;
                const newPoints = points + earnedPoints;
                
                score = newScore;
                streak = newStreak;
                points = newPoints;
                bestStreak = Math.max(bestStreak, newStreak);
                
                updateLevel(earnedPoints);
                
                // Check achievements
                if (newScore === 1) checkAchievements('first_correct');
                checkAchievements('streak', newStreak);
                if (timeLeft > 90) checkAchievements('quick_answer');
                checkAchievements('points', newPoints);
                checkAchievements('category_master');
                
                showFeedback(true, earnedPoints, currentQ.explanation);
            } else {
                streak = 0;
                showFeedback(false, 0, `Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            }
            
            highlightAnswers(answer, isCorrect);
            updateDisplays();
            
            // Check for perfect score
            if (currentQuestion === filteredQuestions.length - 1 && isCorrect && score === filteredQuestions.length) {
                checkAchievements('perfect');
            }
        }

        function skipQuestion() {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            streak = 0;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = false;
            
            showFeedback(false, 0, `Soalan dilangkau. Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            highlightCorrectAnswer();
            updateDisplays();
        }

        // Feedback display
        function showFeedback(isCorrect, earnedPoints, explanation) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            feedbackEl.className = `feedback ${isCorrect ? 'correct' : 'wrong'} show`;
            
            const icon = isCorrect ? '✅' : '❌';
            const title = isCorrect ? `Betul! +${earnedPoints} mata!` : 'Tidak betul.';
            const bonus = (isCorrect && timeLeft > 90) ? '<br><span style="color: #ed8936;">⚡ Bonus Pantas!</span>' : '';
            
            feedbackEl.innerHTML = `
                <div class="feedback-header">
                    <span class="feedback-icon">${icon}</span>
                    <span>${title}${bonus}</span>
                </div>
                <div class="feedback-explanation">${explanation}</div>
            `;
            
            // Update action buttons
            const actionButtons = document.getElementById('actionButtons');
            if (currentQuestion < filteredQuestions.length - 1) {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="nextQuestion()">Seterusnya</button>';
            } else {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="showResults()">Selesai</button>';
            }
        }

        // Answer highlighting
        function highlightAnswers(selectedAnswer, isCorrect) {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else if (optionText === selectedAnswer && !isCorrect) {
                    btn.className = 'option-btn wrong';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        function highlightCorrectAnswer() {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        // Navigation
        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // Display updates
        function updateDisplays() {
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${filteredQuestions.length}`;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('pointsDisplay').textContent = points;
            document.getElementById('streakDisplay').textContent = streak;
            document.getElementById('levelDisplay').textContent = level;
            
            const progressPercent = ((currentQuestion + 1) / filteredQuestions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progressPercent}%`;
            progressFill.textContent = `${Math.round(progressPercent)}%`;
            
            const expPercent = ((experience % 100) / 100) * 100;
            const expFill = document.getElementById('expFill');
            expFill.style.width = `${expPercent}%`;
            document.getElementById('expLabel').textContent = `Pengalaman: ${experience} / ${level * 100}`;
        }

        // Results screen
        function showResults() {
            const gameArea = document.getElementById('gameArea');
            const percentage = Math.round((score / filteredQuestions.length) * 100);
            
            let message = '';
            if (percentage === 100) message = 'SEMPURNA! Pakar Geometri dan Ruang! 🧠👑';
            else if (percentage >= 90) message = 'Cemerlang Sekali! 🌟🏆';
            else if (percentage >= 80) message = 'Cemerlang! 🌟';
            else if (percentage >= 70) message = 'Bagus Sekali! 👍✨';
            else if (percentage >= 60) message = 'Bagus! 👍';
            else if (percentage >= 50) message = 'Boleh Tahan! 💪';
            else message = 'Cuba Lagi! Jangan Putus Asa! 🤗';
            
            let achievementsHTML = '';
            if (unlockedAchievements.length > 0) {
                achievementsHTML = `
                    <div class="achievements-section">
                        <h3>🏆 Pencapaian</h3>
                        <div class="achievements-grid">
                            ${unlockedAchievements.map(id => {
                                const achievement = achievementDefinitions.find(a => a.id === id);
                                return achievement ? `
                                    <div class="achievement-badge">
                                        <div class="achievement-icon">${achievement.icon}</div>
                                        <div class="achievement-name">${achievement.name}</div>
                                    </div>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            gameArea.innerHTML = `
                <div class="complete-screen">
                    <div class="trophy-animation">🏆</div>
                    <h2 style="color: #4a5568; margin-bottom: 30px;">Tahniah!</h2>
                    
                    <div class="final-stats">
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #4a5568;">${score}/${filteredQuestions.length}</div>
                            <div class="final-stat-label">Soalan Betul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #68d391;">${points}</div>
                            <div class="final-stat-label">Mata Dikumpul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ed8936;">${bestStreak}</div>
                            <div class="final-stat-label">Berturut Terbaik</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #718096;">${level}</div>
                            <div class="final-stat-label">Tahap Dicapai</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Peratusan: ${percentage}%</div>
                    <div style="font-size: 1.8em; color: #68d391; margin-bottom: 30px; font-weight: bold;">${message}</div>
                    
                    ${achievementsHTML}
                    
                    <div class="action-buttons" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="restartGame()" style="font-size: 1.2em; padding: 15px 30px; margin-right: 15px;">
                            🔄 Main Lagi
                        </button>
                        <button class="btn btn-back" onclick="goBack()" style="font-size: 1.2em; padding: 15px 30px;">
                            ← Halaman Utama
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('timerDisplay').style.display = 'none';
        }

        // Game restart
        function restartGame() {
            currentQuestion = 0;
            score = 0;
            points = 0;
            streak = 0;
            level = 1;
            experience = 0;
            unlockedAchievements = [];
            categoryStats = {};
            
            document.getElementById('timerDisplay').style.display = 'block';
            filteredQuestions = [...questions];
            loadQuestion();
        }

        // Navigation functions
        function goBack() {
            window.location.href = '../';
        }

        // Initialize the game
        initGame();
    </script>
</body>
</html>
