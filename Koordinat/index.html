<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koordinat, Nisbah dan Kadaran - Math Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #c2185b;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #fce4ec;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .experience-bar {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .exp-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .exp-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #c2185b, #e91e63);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .category-selector {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .category-select {
            padding: 12px 20px;
            border: 2px solid #c2185b;
            border-radius: 8px;
            background: white;
            color: #c2185b;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-select:hover {
            background: #c2185b;
            color: white;
        }
        
        .progress-section {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #c2185b, #f06292);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .timer-fill {
            height: 100%;
            width: 100%;
            transition: all 1s linear;
            background: #66bb6a;
        }
        
        .timer-fill.warning {
            background: #ff9800;
        }
        
        .timer-fill.danger {
            background: #f44336;
            animation: pulse-timer 0.5s infinite alternate;
        }
        
        @keyframes pulse-timer {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }
        
        .question-card {
            background: #fafafa;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            margin-bottom: 20px;
            position: relative;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .question-content {
            flex: 1;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .image-container {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .image-fallback {
            background: #fce4ec;
            padding: 20px;
            border-radius: 8px;
            color: #c2185b;
            font-weight: 500;
        }
        
        .difficulty-badges {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 20px;
        }
        
        .difficulty-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-align: center;
        }
        
        .difficulty-easy { background: #e8f5e9; color: #2e7d32; }
        .difficulty-medium { background: #fff3e0; color: #f57c00; }
        .difficulty-hard { background: #ffebee; color: #c62828; }
        
        .points-badge {
            background: #fce4ec;
            color: #c2185b;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .category-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            padding: 20px;
            border: 2px solid #c2185b;
            border-radius: 12px;
            background: #fdf2f8;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
            position: relative;
            transform-origin: center;
        }
        
        .option-btn:hover:not(:disabled) {
            background: #fce4ec;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(194, 24, 91, 0.15);
        }
        
        .option-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .option-text {
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .option-btn.correct {
            background: #66bb6a;
            color: white;
            border-color: #66bb6a;
            animation: correctPulse 0.6s ease-out;
        }
        
        .option-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: wrongShake 0.5s ease-out;
        }
        
        .option-btn.disabled {
            background: #f0f0f0;
            color: #999;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback {
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .feedback::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .feedback.show::before {
            left: 100%;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #2e7d32;
            border-color: #66bb6a;
        }
        
        .feedback.wrong {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: #c62828;
            border-color: #f44336;
        }
        
        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .feedback-icon {
            font-size: 1.5em;
        }
        
        .feedback-explanation {
            font-weight: normal;
            line-height: 1.5;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #c2185b, #e91e63);
            color: white;
            box-shadow: 0 4px 15px rgba(194, 24, 91, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(194, 24, 91, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #757575, #616161);
            color: white;
            box-shadow: 0 4px 15px rgba(117, 117, 117, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(117, 117, 117, 0.4);
        }
        
        .btn-back {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            border: 2px solid transparent;
        }
        
        .btn-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            border-color: #495057;
        }
        
        .back-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
        }
        
        .timer-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-weight: bold;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .timer-display.warning {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
            animation: pulse 2s infinite;
        }
        
        .timer-display.danger {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: urgentPulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes urgentPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.1) rotate(2deg); }
        }
        
        .complete-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .trophy-animation {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .final-stat {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .final-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .final-stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .achievements-section {
            margin-top: 30px;
            text-align: left;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #e91e63, #f8bbd9);
            color: #880e4f;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e91e63;
            animation: achievementGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes achievementGlow {
            from { box-shadow: 0 4px 15px rgba(233, 30, 99, 0.3); }
            to { box-shadow: 0 8px 25px rgba(233, 30, 99, 0.6); }
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-popup {
            position: fixed;
            top: 70px;
            right: 10px;
            background: #e91e63;
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(233, 30, 99, 0.4);
            z-index: 1001;
            animation: slideInBounce 0.6s ease-out;
            border: 2px solid #f8bbd9;
            max-width: 250px;
        }
        
        @keyframes slideInBounce {
            0% { transform: translateX(400px); opacity: 0; }
            60% { transform: translateX(-20px); opacity: 1; }
            100% { transform: translateX(0); }
        }
        
        .achievement-popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #c2185b;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: 500;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #fce4ec;
        }

        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 5px;
        }
        
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        
        .fraction .denominator {
            display: block;
            padding-top: 2px;
        }

        .math-expression {
            font-family: 'Times New Roman', serif;
            font-size: 1.3em;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .main-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                position: fixed;
                top: 5px;
                right: 5px;
                padding: 8px 15px;
                font-size: 1em;
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .achievement-popup {
                top: 55px;
                right: 5px;
                left: 5px;
                max-width: none;
                padding: 12px;
            }
            
            .difficulty-badges {
                flex-direction: row;
                margin-left: 0;
                margin-top: 15px;
            }
            
            .question-header {
                flex-direction: column;
            }
            
            .final-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            body {
                padding: 10px 5px 5px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="timer-display" id="timerDisplay">‚è∞ 2:00</div>
    
    <div class="back-button-container">
        <button class="btn btn-back" onclick="goBack()">
            ‚Üê Kembali
        </button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">üìç Koordinat, Nisbah dan Kadaran</h1>
            <p class="subtitle">Permainan Matematik Interaktif - Berdasarkan Lembaran Kerja Sebenar</p>
        </div>

        <div class="main-stats">
            <div class="stat-box">
                <div class="stat-number" id="questionCounter" style="color: #c2185b;">1/20</div>
                <div class="stat-label">Soalan</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="scoreDisplay" style="color: #66bb6a;">0</div>
                <div class="stat-label">Skor</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="pointsDisplay" style="color: #2e7d32;">0</div>
                <div class="stat-label">Mata</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="streakDisplay" style="color: #ff9800;">0</div>
                <div class="stat-label">Berturut</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="levelDisplay" style="color: #e91e63;">1</div>
                <div class="stat-label">Tahap</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="timerStat" style="color: #2196f3;">2:00</div>
                <div class="stat-label">Masa</div>
            </div>
        </div>

        <div class="experience-bar">
            <div class="exp-label" id="expLabel">Pengalaman: 0 / 100</div>
            <div class="exp-bar">
                <div class="exp-fill" id="expFill"></div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">5%</div>
            </div>
            <div class="timer-bar">
                <div class="timer-fill" id="timerBar"></div>
            </div>
        </div>

        <div id="gameArea">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-content">
                        <div class="question-text" id="questionText">
                            Loading question...
                        </div>
                        <div id="imageContainer"></div>
                    </div>
                    <div class="difficulty-badges">
                        <div class="difficulty-badge" id="difficultyBadge">Sederhana</div>
                        <div class="points-badge" id="pointsBadge">20 mata</div>
                        <div class="category-badge" id="categoryBadge">Topik</div>
                    </div>
                </div>
                
                <div class="options" id="optionsContainer">
                    <!-- Options will be populated by JavaScript -->
                </div>

                <div id="feedback" style="display: none;"></div>
                
                <div class="action-buttons" id="actionButtons">
                    <button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All 20 questions from the worksheet - with randomized answer positions
        const questions = [
            // Simple questions (1-10)
            {
                id: 1,
                category: 'coordinates',
                difficulty: 'easy',
                question: 'Nyatakan koordinat titik yang berada di (3, 2) pada satah Cartes.',
                answer: '(3, 2)',
                options: ['(2, 3)', '(3, 2)', '(0, 3)', '(3, 0)'],
                explanation: 'Koordinat dinyatakan sebagai (x, y) di mana 3 ialah paksi x dan 2 ialah paksi y.'
            },
            {
                id: 2,
                category: 'coordinates',
                difficulty: 'easy',
                question: 'Koordinat (0, 0) dinamakan sebagai apa?',
                answer: 'Asalan',
                options: ['Asalan', 'Pusat', 'Titik mula', 'Koordinat utama'],
                explanation: 'Koordinat (0, 0) adalah persilangan paksi x dan paksi y, dinamakan asalan.'
            },
            {
                id: 3,
                category: 'ratio',
                difficulty: 'medium',
                question: 'Nyatakan nisbah 12 : 8 dalam bentuk termudah.',
                answer: '3 : 2',
                options: ['6 : 4', '3 : 2', '4 : 3', '2 : 3'],
                explanation: '12 : 8 = 12√∑4 : 8√∑4 = 3 : 2 (dibahagi dengan faktor sepunya terbesar 4)'
            },
            {
                id: 4,
                category: 'ratio',
                difficulty: 'easy',
                question: 'Apakah nisbah bilangan objek biru kepada objek merah jika ada 6 biru dan 9 merah?',
                answer: '2 : 3',
                options: ['6 : 9', '2 : 3', '3 : 2', '1 : 2'],
                explanation: '6 : 9 = 6√∑3 : 9√∑3 = 2 : 3 (dibahagi dengan faktor sepunya terbesar 3)'
            },
            {
                id: 5,
                category: 'proportion',
                difficulty: 'medium',
                question: 'Jika 5 kg tepung diperlukan untuk 100 keping roti, berapakah tepung untuk 60 keping?',
                answer: '3 kg',
                options: ['2 kg', '3 kg', '4 kg', '2.5 kg'],
                explanation: '5 kg untuk 100 keping, jadi 1 keping = 5√∑100 = 0.05 kg. 60 keping = 60 √ó 0.05 = 3 kg'
            },
            {
                id: 6,
                category: 'proportion',
                difficulty: 'easy',
                question: 'Kereta bergerak 80 km dalam 2 jam. Berapakah jarak dalam 3 jam dengan laju yang sama?',
                answer: '120 km',
                options: ['100 km', '120 km', '140 km', '160 km'],
                explanation: 'Laju = 80 km √∑ 2 jam = 40 km/jam. Dalam 3 jam = 40 √ó 3 = 120 km'
            },
            {
                id: 7,
                category: 'ratio',
                difficulty: 'medium',
                question: 'Panjang segi empat sama ialah 8 cm. Apakah nisbah satu sisi kepada perimeter?',
                answer: '1 : 4',
                options: ['1 : 8', '1 : 4', '8 : 1', '4 : 1'],
                explanation: 'Perimeter segi empat sama = 4 √ó 8 = 32 cm. Nisbah = 8 : 32 = 1 : 4'
            },
            {
                id: 8,
                category: 'coordinates',
                difficulty: 'medium',
                question: 'Titik mana yang berada di paksi y?',
                answer: '(0, 5)',
                options: ['(5, 0)', '(0, 5)', '(3, 3)', '(1, 2)'],
                explanation: 'Titik pada paksi y mempunyai koordinat x = 0, jadi (0, 5) berada di paksi y.'
            },
            {
                id: 9,
                category: 'proportion',
                difficulty: 'medium',
                question: '3 kotak mengandungi 24 biji guli. Berapakah biji guli dalam 7 kotak?',
                answer: '56 biji',
                options: ['48 biji', '56 biji', '63 biji', '72 biji'],
                explanation: '1 kotak = 24 √∑ 3 = 8 biji guli. 7 kotak = 7 √ó 8 = 56 biji guli'
            },
            {
                id: 10,
                category: 'ratio',
                difficulty: 'easy',
                question: 'Jika nisbah A : B = 2 : 3 dan A = 10, berapakah nilai B?',
                answer: '15',
                options: ['12', '15', '18', '20'],
                explanation: 'A : B = 2 : 3, jadi 10 : B = 2 : 3. B = (10 √ó 3) √∑ 2 = 15'
            },

            // Complex word problems (11-20)
            {
                id: 11,
                category: 'coordinates',
                difficulty: 'hard',
                question: 'Satah Cartes menunjukkan kedai Goh yang menjual pelbagai barang. Berdasarkan koordinat yang diberikan:',
                subquestions: [
                    'a) Nyatakan koordinat bola',
                    'b) Hitung jumlah bayaran Amalina jika dia membeli barang di koordinat (0, 2), (3, 5) dan (2, 3)'
                ],
                image: {
                    src: 'images/kedai-goh-coordinates.png',
                    alt: 'Satah Cartes menunjukkan kedudukan barang di Kedai Goh',
                    description: 'Peta koordinat kedai dengan bola di (2, 0), mainan di lokasi lain, dan jadual harga: Bola RM24.00, Layang-layang RM8.50, Kereta mainan RM17.80'
                },
                answer: '(2, 0), RM33.50',
                options: ['(0, 2), RM35.00', '(2, 0), RM33.50', '(2, 1), RM30.00', '(1, 2), RM40.00'],
                explanation: 'a) Bola berada di koordinat (2, 0). b) Barang: kucing (0,2)=RM17.80, layang-layang (3,5)=RM8.50, bola (2,3)=RM6.00. Jumlah: RM32.30'
            },
            {
                id: 12,
                category: 'ratio',
                difficulty: 'hard',
                question: 'Gambar menunjukkan kucing peliharaan Shahir. Chan memelihara 3 ekor kucing lebih daripada Shahir. Jika Shahir ada 2 ekor kucing, apakah nisbah bilangan kucing Shahir kepada bilangan kucing Chan?',
                image: {
                    src: 'images/shahir-chan-cats.png',
                    alt: 'Kucing peliharaan Shahir',
                    description: 'Gambar menunjukkan seekor kucing comel Shahir, dan keterangan bahawa Chan ada 3 ekor lebih'
                },
                answer: '2 : 5',
                options: ['1 : 3', '2 : 5', '3 : 2', '2 : 3'],
                explanation: 'Shahir: 2 ekor, Chan: 2 + 3 = 5 ekor. Nisbah Shahir : Chan = 2 : 5'
            },
            {
                id: 13,
                category: 'ratio',
                difficulty: 'medium',
                question: 'Jadual menunjukkan panjang papan yang dicat dengan warna biru dan hijau. Papan biru panjangnya 1 m, manakala papan hijau 200 cm lebih panjang daripada papan biru. Nyatakan nisbah panjang papan biru kepada panjang papan hijau.',
                image: {
                    src: 'images/papan-warna-table.png',
                    alt: 'Jadual panjang papan biru dan hijau',
                    description: 'Jadual menunjukkan: Papan biru: 1 m, Papan hijau: 200 cm lebih panjang dari papan biru'
                },
                answer: '1 : 3',
                options: ['1 : 2', '1 : 3', '2 : 3', '3 : 1'],
                explanation: 'Biru: 1 m = 100 cm. Hijau: 100 + 200 = 300 cm. Nisbah = 100 : 300 = 1 : 3'
            },
            {
                id: 14,
                category: 'proportion',
                difficulty: 'hard',
                question: 'Victor memandu kereta dengan laju yang sama sejauh 240 km dalam 3 jam. Berapakah jarak yang dilaluinya dalam 5 jam dengan laju yang sama?',
                image: {
                    src: 'images/victor-driving-distance.png',
                    alt: 'Victor memandu kereta dengan laju tetap',
                    description: 'Gambar menunjukkan Victor memandu kereta di jalan raya dengan papan tanda jarak dan masa'
                },
                answer: '400 km',
                options: ['360 km', '400 km', '450 km', '480 km'],
                explanation: 'Laju = 240 km √∑ 3 jam = 80 km/jam. Dalam 5 jam = 80 √ó 5 = 400 km'
            },
            {
                id: 15,
                category: 'coordinates',
                difficulty: 'hard',
                question: 'Peta menunjukkan beberapa tempat tumpuan di Pulau Pinang pada satah Cartes. Lengkapkan jadual koordinat untuk tempat-tempat berikut:',
                subquestions: [
                    'a) Koordinat (0, 0) berada di persilangan paksi x dan paksi y, dinamakan asalan',
                    'b) Nyatakan koordinat Pantai, Taman burung, dan Muzium'
                ],
                image: {
                    src: 'images/penang-tourist-map.png',
                    alt: 'Peta tempat tumpuan Pulau Pinang',
                    description: 'Satah Cartes dengan Pantai (1, 4), Bukit (2, 2), Lapangan terbang (1, 1), Hutan rekreasi (4, 2), Taman burung (3, 3), Muzium (2, 0)'
                },
                answer: '(1,4), (3,3), (2,0)',
                options: ['(1,3), (3,4), (2,1)', '(1,4), (3,3), (2,0)', '(2,4), (3,2), (1,0)', '(4,1), (2,3), (0,2)'],
                explanation: 'Berdasarkan peta: Pantai (1,4), Taman burung (3,3), Muzium (2,0)'
            },
            {
                id: 16,
                category: 'coordinates',
                difficulty: 'medium',
                question: 'Tandakan titik koordinat (1, 1), (5, 1) dan (3, 6) pada satah Cartes. Jika semua titik disambungkan, apakah bentuk yang terhasil?',
                image: {
                    src: 'images/triangle-coordinates.png',
                    alt: 'Titik koordinat yang membentuk segitiga',
                    description: 'Satah Cartes dengan titik-titik (1,1), (5,1), dan (3,6) yang apabila disambungkan membentuk segitiga'
                },
                answer: 'Segitiga',
                options: ['Segi empat', 'Segitiga', 'Pentagon', 'Bulatan'],
                explanation: 'Tiga titik yang tidak selari akan membentuk segitiga apabila disambungkan'
            },
            {
                id: 17,
                category: 'ratio',
                difficulty: 'hard',
                question: 'Berdasarkan jadual bilangan guli dalam kotak P, Q, R dan S:',
                subquestions: [
                    'Kotak P: 1 biji, Q: 2 biji, R: 3 kali bilangan Q, S: 7 biji lebih daripada P',
                    'a) Nyatakan nisbah guli kotak P kepada kotak R',
                    'b) Nyatakan nisbah guli kotak P kepada kotak S'
                ],
                image: {
                    src: 'images/guli-boxes-table.png',
                    alt: 'Jadual bilangan guli dalam kotak',
                    description: 'Jadual menunjukkan: P=1, Q=2, R=3√óQ=6, S=P+7=8'
                },
                answer: '1:6, 1:8',
                options: ['1:3, 1:7', '1:6, 1:8', '2:6, 2:8', '1:2, 1:3'],
                explanation: 'P=1, Q=2, R=3√ó2=6, S=1+7=8. a) P:R = 1:6, b) P:S = 1:8'
            },
            {
                id: 18,
                category: 'proportion',
                difficulty: 'medium',
                question: 'Jisim 4 bar coklat ialah 0.656 kg. Hitung jisim 15 bar coklat yang sama.',
                image: {
                    src: 'images/chocolate-bars-weight.png',
                    alt: '4 bar coklat dengan jisim 0.656 kg',
                    description: 'Gambar menunjukkan 4 bar coklat dengan timbangan menunjukkan 0.656 kg'
                },
                answer: '2.46 kg',
                options: ['2.34 kg', '2.46 kg', '2.58 kg', '2.64 kg'],
                explanation: '1 bar = 0.656 √∑ 4 = 0.164 kg. 15 bar = 15 √ó 0.164 = 2.46 kg'
            },
            {
                id: 19,
                category: 'proportion',
                difficulty: 'hard',
                question: 'Karina membayar tambang teksi RM8.30 untuk perjalanan sehala pada hari Jumaat dan Sabtu. Berdasarkan jadual kadar tambang, ke manakah Karina pergi? Nyatakan koordinat tempat itu.',
                subquestions: [
                    'Jadual tambang: Restoran RM3.50, Muzium RM4.80, Sekolah RM2.20',
                    'Jumlah 2 hari = RM8.30'
                ],
                image: {
                    src: 'images/karina-taxi-map.png',
                    alt: 'Peta kedudukan rumah Karina dan destinasi',
                    description: 'Satah Cartes dengan rumah Karina, sekolah (3,4), muzium (5,6), restoran (5,2), dan jadual tambang'
                },
                answer: 'Restoran (5,2)',
                options: ['Sekolah (3,4)', 'Restoran (5,2)', 'Muzium (5,6)', 'Rumah (1,1)'],
                explanation: 'RM8.30 √∑ 2 = RM4.15 tidak tepat dengan mana-mana kadar. Tetapi RM3.50 + RM4.80 = RM8.30 (2 destinasi berbeza) atau 2 √ó RM4.15 ‚âà Muzium'
            },
            {
                id: 20,
                category: 'proportion',
                difficulty: 'hard',
                question: 'Erik merancang perjalanan dari bandar R ke bandar U melalui bandar S dan bandar T. Berdasarkan jadual jarak:',
                subquestions: [
                    'R ke S: 1 km, S ke T: 99 km, T ke U: 900 km',
                    'a) Nisbah jarak R-S kepada R-T',
                    'b) Nisbah jarak R-S kepada R-U (keseluruhan)'
                ],
                image: {
                    src: 'images/erik-journey-route.png',
                    alt: 'Peta laluan perjalanan Erik',
                    description: 'Peta menunjukkan laluan R‚ÜíS‚ÜíT‚ÜíU dengan jarak masing-masing dan jumlah keseluruhan'
                },
                answer: '1:100, 1:1000',
                options: ['1:99, 1:999', '1:100, 1:1000', '1:98, 1:998', '2:100, 2:1000'],
                explanation: 'R-T = 1+99 = 100 km. R-U = 1+99+900 = 1000 km. a) 1:100, b) 1:1000'
            }
        ];

        // Achievement definitions
        const achievementDefinitions = [
            { id: 'first_correct', name: 'Permulaan Hebat!', description: 'Jawab soalan pertama dengan betul', icon: 'üåü' },
            { id: 'streak_3', name: 'Dalam Rentak!', description: 'Jawab 3 soalan berturut-turut dengan betul', icon: 'üî•' },
            { id: 'streak_5', name: 'Hebat Sungguh!', description: 'Jawab 5 soalan berturut-turut dengan betul', icon: '‚ö°' },
            { id: 'quick_thinker', name: 'Pemikir Pantas!', description: 'Jawab dalam 10 saat', icon: 'üí®' },
            { id: 'level_2', name: 'Naik Tahap!', description: 'Capai tahap 2', icon: 'üéØ' },
            { id: 'level_3', name: 'Pakar Matematik!', description: 'Capai tahap 3', icon: 'üëë' },
            { id: 'perfect_score', name: 'Sempurna!', description: 'Dapatkan 100% markah', icon: 'üèÜ' },
            { id: 'high_scorer', name: 'Pencapai Tinggi!', description: 'Kumpul 500+ mata', icon: 'üíé' },
            { id: 'coordinates_master', name: 'Pakar Koordinat!', description: 'Jawab semua soalan koordinat dengan betul', icon: 'üìç' },
            { id: 'ratio_expert', name: 'Ahli Nisbah!', description: 'Jawab semua soalan nisbah dengan betul', icon: '‚öñÔ∏è' },
            { id: 'proportion_pro', name: 'Pro Kadaran!', description: 'Jawab semua soalan kadaran dengan betul', icon: 'üìä' },
            { id: 'problem_solver', name: 'Penyelesai Masalah!', description: 'Jawab semua masalah kompleks dengan betul', icon: 'üß©' }
        ];

        // Game state
        let currentQuestion = 0;
        let score = 0;
        let points = 0;
        let streak = 0;
        let bestStreak = 0;
        let level = 1;
        let experience = 0;
        let timeLeft = 30;
        let timerInterval;
        let gameActive = true;
        let unlockedAchievements = [];
        let filteredQuestions = [];
        let categoryStats = {};

        // Shuffle array function for options only
        function shuffleOptions(question) {
            const correctAnswer = question.answer;
            const shuffledOptions = [...question.options];
            
            // Shuffle the options array
            for (let i = shuffledOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
            }
            
            return {
                ...question,
                options: shuffledOptions,
                answer: correctAnswer // Keep the correct answer unchanged
            };
        }

        // Initialize game
        function initGame() {
            console.log('Initializing game...');
            console.log('Questions array length:', questions.length);
            
            // Always use all questions, no filtering
            filteredQuestions = [...questions];
            console.log('Filtered questions length:', filteredQuestions.length);
            
            if (filteredQuestions.length > 0) {
                loadQuestion();
                startTimer();
                updateDisplays();
            } else {
                console.error('No questions available!');
            }
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120; // 2 minutes
            gameActive = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timerDisplay');
            const timerBar = document.getElementById('timerBar');
            const timerStat = document.getElementById('timerStat');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            timerEl.textContent = `‚è∞ ${timeText}`;
            timerStat.textContent = timeText;
            timerBar.style.width = `${(timeLeft / 120) * 100}%`;
            
            if (timeLeft <= 10) {
                timerEl.className = 'timer-display danger';
                timerBar.className = 'timer-fill danger';
                timerStat.style.color = '#f44336';
            } else if (timeLeft <= 30) {
                timerEl.className = 'timer-display warning';
                timerBar.className = 'timer-fill warning';
                timerStat.style.color = '#ff9800';
            } else {
                timerEl.className = 'timer-display';
                timerBar.className = 'timer-fill';
                timerStat.style.color = '#2196f3';
            }
        }

        // Points calculation
        function calculatePoints(difficulty, timeRemaining, isCorrect) {
            if (!isCorrect) return 0;
            
            let basePoints = 0;
            switch (difficulty) {
                case 'easy': basePoints = 10; break;
                case 'medium': basePoints = 20; break;
                case 'hard': basePoints = 30; break;
                default: basePoints = 15;
            }
            
            let timeBonus = timeRemaining > 60 ? 10 : timeRemaining > 30 ? 5 : 0;
            let streakMultiplier = Math.min(streak + 1, 3);
            
            return Math.round((basePoints + timeBonus) * streakMultiplier);
        }

        // Level and experience
        function updateLevel(newPoints) {
            const newExperience = experience + newPoints;
            const newLevel = Math.floor(newExperience / 100) + 1;
            
            if (newLevel > level) {
                checkAchievements('level', newLevel);
                showLevelUp(newLevel);
            }
            
            experience = newExperience;
            level = newLevel;
        }

        function showLevelUp(newLevel) {
            const levelEl = document.getElementById('levelDisplay');
            levelEl.style.animation = 'bounce 1s ease-out';
            setTimeout(() => {
                levelEl.style.animation = '';
            }, 1000);
        }

        // Achievement system
        function checkAchievements(type, value) {
            const newAchievements = [];
            
            switch (type) {
                case 'first_correct':
                    if (score === 0 && !unlockedAchievements.includes('first_correct')) {
                        newAchievements.push('first_correct');
                    }
                    break;
                case 'streak':
                    if (value >= 3 && !unlockedAchievements.includes('streak_3')) newAchievements.push('streak_3');
                    if (value >= 5 && !unlockedAchievements.includes('streak_5')) newAchievements.push('streak_5');
                    break;
                case 'quick_answer':
                    if (timeLeft > 90 && !unlockedAchievements.includes('quick_thinker')) {
                        newAchievements.push('quick_thinker');
                    }
                    break;
                case 'level':
                    if (value >= 2 && !unlockedAchievements.includes('level_2')) newAchievements.push('level_2');
                    if (value >= 3 && !unlockedAchievements.includes('level_3')) newAchievements.push('level_3');
                    break;
                case 'points':
                    if (value >= 500 && !unlockedAchievements.includes('high_scorer')) {
                        newAchievements.push('high_scorer');
                    }
                    break;
                case 'perfect':
                    if (!unlockedAchievements.includes('perfect_score')) {
                        newAchievements.push('perfect_score');
                    }
                    break;
                case 'category_master':
                    checkCategoryMaster(newAchievements);
                    break;
            }
            
            if (newAchievements.length > 0) {
                unlockedAchievements.push(...newAchievements);
                showAchievementPopup(newAchievements[0]);
            }
        }

        function checkCategoryMaster(newAchievements) {
            const coordinatesQuestions = questions.filter(q => q.category === 'coordinates');
            const ratioQuestions = questions.filter(q => q.category === 'ratio');
            const proportionQuestions = questions.filter(q => q.category === 'proportion');
            
            if (!unlockedAchievements.includes('coordinates_master') && 
                coordinatesQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('coordinates_master');
            }
            
            if (!unlockedAchievements.includes('ratio_expert') && 
                ratioQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('ratio_expert');
            }
            
            if (!unlockedAchievements.includes('proportion_pro') && 
                proportionQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('proportion_pro');
            }
        }

        function showAchievementPopup(achievementId) {
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-popup-header">
                    <span style="font-size: 2em;">üèÜ</span>
                    <div>
                        <div style="font-weight: bold;">Pencapaian Baru!</div>
                        <div>${achievement.icon} ${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 3000);
        }

        // Question loading
        function loadQuestion() {
            if (currentQuestion >= filteredQuestions.length) {
                showResults();
                return;
            }
            
            // Get question and shuffle its options only
            const originalQ = filteredQuestions[currentQuestion];
            const currentQ = shuffleOptions(originalQ);
            
            // Format question with subquestions if available
            let questionHTML = currentQ.question;
            if (currentQ.subquestions) {
                questionHTML += '<br><br>';
                currentQ.subquestions.forEach(subq => {
                    questionHTML += subq + '<br>';
                });
            }
            
            document.getElementById('questionText').innerHTML = questionHTML;
            
            // Update difficulty and points badges
            const difficultyBadge = document.getElementById('difficultyBadge');
            const pointsBadge = document.getElementById('pointsBadge');
            const categoryBadge = document.getElementById('categoryBadge');
            
            const difficultyText = {
                'easy': 'Mudah',
                'medium': 'Sederhana', 
                'hard': 'Sukar'
            };
            
            const pointsText = {
                'easy': '10',
                'medium': '20',
                'hard': '30'
            };

            const categoryText = {
                'coordinates': 'Koordinat',
                'ratio': 'Nisbah',
                'proportion': 'Kadaran'
            };
            
            difficultyBadge.textContent = difficultyText[currentQ.difficulty] || 'Sederhana';
            difficultyBadge.className = `difficulty-badge difficulty-${currentQ.difficulty || 'medium'}`;
            pointsBadge.textContent = `${pointsText[currentQ.difficulty] || '20'} mata`;
            categoryBadge.textContent = categoryText[currentQ.category] || 'Matematik';
            
            // Store the current question with shuffled options for answer checking
            window.currentQuestionData = currentQ;
            
            // Load image if present
            loadQuestionImage(currentQ);
            
            // Update options (now shuffled)
            loadOptions(currentQ);
            
            // Reset feedback and buttons
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('actionButtons').innerHTML = 
                '<button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>';
            
            // Start timer
            startTimer();
            updateDisplays();
        }

        function loadQuestionImage(question) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            container.style.display = 'none';
            
            if (question.image) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-container';
                
                if (question.image.src) {
                    const img = document.createElement('img');
                    img.src = question.image.src;
                    img.alt = question.image.alt;
                    img.onerror = function() {
                        imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                    };
                    imageDiv.appendChild(img);
                } else if (question.image.description) {
                    imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                }
                
                container.appendChild(imageDiv);
                container.style.display = 'block';
            }
        }

        function loadOptions(question) {
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-label">Pilihan ${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                btn.dataset.answer = option;
                btn.onclick = () => selectAnswer(option);
                container.appendChild(btn);
            });
        }

        // Answer selection
        function selectAnswer(answer) {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const isCorrect = answer === currentQ.answer;
            const earnedPoints = calculatePoints(currentQ.difficulty, timeLeft, isCorrect);
            
            // Track category performance using original question id
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = isCorrect;
            
            if (isCorrect) {
                const newScore = score + 1;
                const newStreak = streak + 1;
                const newPoints = points + earnedPoints;
                
                score = newScore;
                streak = newStreak;
                points = newPoints;
                bestStreak = Math.max(bestStreak, newStreak);
                
                updateLevel(earnedPoints);
                
                // Check achievements
                if (newScore === 1) checkAchievements('first_correct');
                checkAchievements('streak', newStreak);
                if (timeLeft > 90) checkAchievements('quick_answer');
                checkAchievements('points', newPoints);
                checkAchievements('category_master');
                
                showFeedback(true, earnedPoints, currentQ.explanation);
            } else {
                streak = 0;
                showFeedback(false, 0, `Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            }
            
            highlightAnswers(answer, isCorrect);
            updateDisplays();
            
            // Check for perfect score
            if (currentQuestion === filteredQuestions.length - 1 && isCorrect && score === filteredQuestions.length) {
                checkAchievements('perfect');
            }
        }

        function skipQuestion() {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            streak = 0;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = false;
            
            showFeedback(false, 0, `Soalan dilangkau. Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            highlightCorrectAnswer();
            updateDisplays();
        }

        // Feedback display
        function showFeedback(isCorrect, earnedPoints, explanation) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            feedbackEl.className = `feedback ${isCorrect ? 'correct' : 'wrong'} show`;
            
            const icon = isCorrect ? '‚úÖ' : '‚ùå';
            const title = isCorrect ? `Betul! +${earnedPoints} mata!` : 'Tidak betul.';
            const bonus = (isCorrect && timeLeft > 90) ? '<br><span style="color: #ff9800;">‚ö° Bonus Pantas!</span>' : '';
            
            feedbackEl.innerHTML = `
                <div class="feedback-header">
                    <span class="feedback-icon">${icon}</span>
                    <span>${title}${bonus}</span>
                </div>
                <div class="feedback-explanation">${explanation}</div>
            `;
            
            // Update action buttons
            const actionButtons = document.getElementById('actionButtons');
            if (currentQuestion < filteredQuestions.length - 1) {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="nextQuestion()">Seterusnya</button>';
            } else {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="showResults()">Selesai</button>';
            }
        }

        // Answer highlighting
        function highlightAnswers(selectedAnswer, isCorrect) {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else if (optionText === selectedAnswer && !isCorrect) {
                    btn.className = 'option-btn wrong';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        function highlightCorrectAnswer() {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        // Navigation
        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // Display updates
        function updateDisplays() {
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${filteredQuestions.length}`;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('pointsDisplay').textContent = points;
            document.getElementById('streakDisplay').textContent = streak;
            document.getElementById('levelDisplay').textContent = level;
            
            const progressPercent = ((currentQuestion + 1) / filteredQuestions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progressPercent}%`;
            progressFill.textContent = `${Math.round(progressPercent)}%`;
            
            const expPercent = ((experience % 100) / 100) * 100;
            const expFill = document.getElementById('expFill');
            expFill.style.width = `${expPercent}%`;
            document.getElementById('expLabel').textContent = `Pengalaman: ${experience} / ${level * 100}`;
        }

        // Results screen
        function showResults() {
            const gameArea = document.getElementById('gameArea');
            const percentage = Math.round((score / filteredQuestions.length) * 100);
            
            let message = '';
            if (percentage === 100) message = 'SEMPURNA! Pakar Koordinat, Nisbah dan Kadaran! üß†üëë';
            else if (percentage >= 90) message = 'Cemerlang Sekali! üåüüèÜ';
            else if (percentage >= 80) message = 'Cemerlang! üåü';
            else if (percentage >= 70) message = 'Bagus Sekali! üëç‚ú®';
            else if (percentage >= 60) message = 'Bagus! üëç';
            else if (percentage >= 50) message = 'Boleh Tahan! üí™';
            else message = 'Cuba Lagi! Jangan Putus Asa! ü§ó';
            
            let achievementsHTML = '';
            if (unlockedAchievements.length > 0) {
                achievementsHTML = `
                    <div class="achievements-section">
                        <h3>üèÜ Pencapaian</h3>
                        <div class="achievements-grid">
                            ${unlockedAchievements.map(id => {
                                const achievement = achievementDefinitions.find(a => a.id === id);
                                return achievement ? `
                                    <div class="achievement-badge">
                                        <div class="achievement-icon">${achievement.icon}</div>
                                        <div class="achievement-name">${achievement.name}</div>
                                    </div>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            gameArea.innerHTML = `
                <div class="complete-screen">
                    <div class="trophy-animation">üèÜ</div>
                    <h2 style="color: #c2185b; margin-bottom: 30px;">Tahniah!</h2>
                    
                    <div class="final-stats">
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #c2185b;">${score}/${filteredQuestions.length}</div>
                            <div class="final-stat-label">Soalan Betul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #66bb6a;">${points}</div>
                            <div class="final-stat-label">Mata Dikumpul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ff9800;">${bestStreak}</div>
                            <div class="final-stat-label">Berturut Terbaik</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #e91e63;">${level}</div>
                            <div class="final-stat-label">Tahap Dicapai</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Peratusan: ${percentage}%</div>
                    <div style="font-size: 1.8em; color: #66bb6a; margin-bottom: 30px; font-weight: bold;">${message}</div>
                    
                    ${achievementsHTML}
                    
                    <div class="action-buttons" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="restartGame()" style="font-size: 1.2em; padding: 15px 30px; margin-right: 15px;">
                            üîÑ Main Lagi
                        </button>
                        <button class="btn btn-back" onclick="goBack()" style="font-size: 1.2em; padding: 15px 30px;">
                            ‚Üê Halaman Utama
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('timerDisplay').style.display = 'none';
        }

        // Game restart
        function restartGame() {
            currentQuestion = 0;
            score = 0;
            points = 0;
            streak = 0;
            level = 1;
            experience = 0;
            unlockedAchievements = [];
            categoryStats = {};
            
            document.getElementById('timerDisplay').style.display = 'block';
            filteredQuestions = [...questions];
            loadQuestion();
        }

        // Navigation functions
        function goBack() {
            window.location.href = '../';
        }

        // Initialize the game
        initGame();
    </script>
</body>
</html>
