<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pengurusan Data - Math Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe8cc 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #e65100;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #fff3e0;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .experience-bar {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .exp-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .exp-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #e65100, #ff8a50);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .category-selector {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .category-select {
            padding: 12px 20px;
            border: 2px solid #e65100;
            border-radius: 8px;
            background: white;
            color: #e65100;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-select:hover {
            background: #e65100;
            color: white;
        }
        
        .progress-section {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #e65100, #ff8a50);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .timer-fill {
            height: 100%;
            width: 100%;
            transition: all 1s linear;
            background: #ff8a50;
        }
        
        .timer-fill.warning {
            background: #ff9800;
        }
        
        .timer-fill.danger {
            background: #f44336;
            animation: pulse-timer 0.5s infinite alternate;
        }
        
        @keyframes pulse-timer {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }
        
        .question-card {
            background: #fafafa;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            margin-bottom: 20px;
            position: relative;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .question-content {
            flex: 1;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .image-container {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .image-fallback {
            background: #fff3e0;
            padding: 20px;
            border-radius: 8px;
            color: #e65100;
            font-weight: 500;
        }
        
        .difficulty-badges {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 20px;
        }
        
        .difficulty-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-align: center;
        }
        
        .difficulty-easy { background: #e8f5e9; color: #2e7d32; }
        .difficulty-medium { background: #fff3e0; color: #e65100; }
        .difficulty-hard { background: #ffebee; color: #c62828; }
        
        .points-badge {
            background: #fff3e0;
            color: #e65100;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .category-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            padding: 20px;
            border: 2px solid #e65100;
            border-radius: 12px;
            background: #fff8f0;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
            position: relative;
            transform-origin: center;
        }
        
        .option-btn:hover:not(:disabled) {
            background: #fff3e0;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(230, 81, 0, 0.15);
        }
        
        .option-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .option-text {
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .option-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            animation: correctPulse 0.6s ease-out;
        }
        
        .option-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: wrongShake 0.5s ease-out;
        }
        
        .option-btn.disabled {
            background: #f0f0f0;
            color: #999;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback {
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .feedback::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .feedback.show::before {
            left: 100%;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #2e7d32;
            border-color: #4caf50;
        }
        
        .feedback.wrong {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: #c62828;
            border-color: #f44336;
        }
        
        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .feedback-icon {
            font-size: 1.5em;
        }
        
        .feedback-explanation {
            font-weight: normal;
            line-height: 1.5;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #e65100, #ff8a50);
            color: white;
            box-shadow: 0 4px 15px rgba(230, 81, 0, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(230, 81, 0, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #757575, #616161);
            color: white;
            box-shadow: 0 4px 15px rgba(117, 117, 117, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(117, 117, 117, 0.4);
        }
        
        .btn-back {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            border: 2px solid transparent;
        }
        
        .btn-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            border-color: #495057;
        }
        
        .back-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
        }
        
        .timer-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-weight: bold;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .timer-display.warning {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
            animation: pulse 2s infinite;
        }
        
        .timer-display.danger {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: urgentPulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes urgentPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.1) rotate(2deg); }
        }
        
        .complete-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .trophy-animation {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .final-stat {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .final-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .final-stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .achievements-section {
            margin-top: 30px;
            text-align: left;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #ff8a50, #ffb74d);
            color: #e65100;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #ff8a50;
            animation: achievementGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes achievementGlow {
            from { box-shadow: 0 4px 15px rgba(255, 138, 80, 0.3); }
            to { box-shadow: 0 8px 25px rgba(255, 138, 80, 0.6); }
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-popup {
            position: fixed;
            top: 70px;
            right: 10px;
            background: #ff8a50;
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255, 138, 80, 0.4);
            z-index: 1001;
            animation: slideInBounce 0.6s ease-out;
            border: 2px solid #ffb74d;
            max-width: 250px;
        }
        
        @keyframes slideInBounce {
            0% { transform: translateX(400px); opacity: 0; }
            60% { transform: translateX(-20px); opacity: 1; }
            100% { transform: translateX(0); }
        }
        
        .achievement-popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #e65100;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: 500;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #fff3e0;
        }

        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 5px;
        }
        
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        
        .fraction .denominator {
            display: block;
            padding-top: 2px;
        }

        .math-expression {
            font-family: 'Times New Roman', serif;
            font-size: 1.3em;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .main-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                position: fixed;
                top: 5px;
                right: 5px;
                padding: 8px 15px;
                font-size: 1em;
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .achievement-popup {
                top: 55px;
                right: 5px;
                left: 5px;
                max-width: none;
                padding: 12px;
            }
            
            .difficulty-badges {
                flex-direction: row;
                margin-left: 0;
                margin-top: 15px;
            }
            
            .question-header {
                flex-direction: column;
            }
            
            .final-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            body {
                padding: 10px 5px 5px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="timer-display" id="timerDisplay">⏰ 2:00</div>
    
    <div class="back-button-container">
        <button class="btn btn-back" onclick="goBack()">
            ← Kembali
        </button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">📊 Pengurusan Data</h1>
            <p class="subtitle">Permainan Matematik Interaktif - Piktograf dan Carta Palang</p>
        </div>

        <div class="main-stats">
            <div class="stat-box">
                <div class="stat-number" id="questionCounter" style="color: #e65100;">1/20</div>
                <div class="stat-label">Soalan</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="scoreDisplay" style="color: #4caf50;">0</div>
                <div class="stat-label">Skor</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="pointsDisplay" style="color: #2e7d32;">0</div>
                <div class="stat-label">Mata</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="streakDisplay" style="color: #ff9800;">0</div>
                <div class="stat-label">Berturut</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="levelDisplay" style="color: #ff8a50;">1</div>
                <div class="stat-label">Tahap</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="timerStat" style="color: #2196f3;">2:00</div>
                <div class="stat-label">Masa</div>
            </div>
        </div>

        <div class="experience-bar">
            <div class="exp-label" id="expLabel">Pengalaman: 0 / 100</div>
            <div class="exp-bar">
                <div class="exp-fill" id="expFill"></div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">5%</div>
            </div>
            <div class="timer-bar">
                <div class="timer-fill" id="timerBar"></div>
            </div>
        </div>

        <div id="gameArea">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-content">
                        <div class="question-text" id="questionText">
                            Loading question...
                        </div>
                        <div id="imageContainer"></div>
                    </div>
                    <div class="difficulty-badges">
                        <div class="difficulty-badge" id="difficultyBadge">Sederhana</div>
                        <div class="points-badge" id="pointsBadge">20 mata</div>
                        <div class="category-badge" id="categoryBadge">Topik</div>
                    </div>
                </div>
                
                <div class="options" id="optionsContainer">
                    <!-- Options will be populated by JavaScript -->
                </div>

                <div id="feedback" style="display: none;"></div>
                
                <div class="action-buttons" id="actionButtons">
                    <button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All 20 questions about data management - pictographs and bar charts
        const questions = [
            // Simple questions (1-10)
            {
                id: 1,
                category: 'pictograph_basics',
                difficulty: 'easy',
                question: 'Dalam piktograf, jika 🍎 mewakili 5 buah epal, berapa epal yang diwakili oleh 🍎🍎🍎?',
                answer: '15 buah epal',
                options: ['10 buah epal', '15 buah epal', '20 buah epal', '8 buah epal'],
                explanation: '3 simbol × 5 epal setiap simbol = 15 buah epal'
            },
            {
                id: 2,
                category: 'pictograph_basics',
                difficulty: 'easy',
                question: 'Sebuah piktograf menunjukkan ⭐ mewakili 4 orang pelajar. Berapa simbol diperlukan untuk mewakili 24 orang pelajar?',
                answer: '6 simbol',
                options: ['5 simbol', '6 simbol', '7 simbol', '8 simbol'],
                explanation: '24 ÷ 4 = 6 simbol diperlukan'
            },
            {
                id: 3,
                category: 'bar_chart_reading',
                difficulty: 'easy',
                question: 'Dalam carta palang, jika ketinggian palang bagi buah mangga ialah 8 unit dan setiap unit mewakili 5 buah, berapa buah mangga keseluruhan?',
                image: {
                    src: 'images/mango-bar-chart.png',
                    alt: 'Carta palang menunjukkan kuantiti mangga',
                    description: 'Carta palang menunjukkan palang mangga dengan ketinggian 8 unit, dan skala menunjukkan setiap unit mewakili 5 buah mangga'
                },
                answer: '40 buah',
                options: ['35 buah', '40 buah', '45 buah', '50 buah'],
                explanation: '8 unit × 5 buah setiap unit = 40 buah mangga'
            },
            {
                id: 4,
                category: 'pictograph_interpretation',
                difficulty: 'medium',
                question: 'Dalam piktograf jenis kenderaan, kereta diwakili oleh 🚗🚗🚗🚗 dan motosikal oleh 🏍️🏍️. Jika setiap simbol mewakili 6 kenderaan, berapa banyak lagi kereta daripada motosikal?',
                image: {
                    src: 'images/vehicle-pictograph.png',
                    alt: 'Piktograf jenis kenderaan',
                    description: 'Piktograf menunjukkan 4 simbol kereta dan 2 simbol motosikal, dengan legenda menunjukkan setiap simbol mewakili 6 kenderaan'
                },
                answer: '12 kenderaan',
                options: ['6 kenderaan', '12 kenderaan', '18 kenderaan', '24 kenderaan'],
                explanation: 'Kereta: 4 × 6 = 24, Motosikal: 2 × 6 = 12. Beza: 24 - 12 = 12 kenderaan'
            },
            {
                id: 5,
                category: 'bar_chart_comparison',
                difficulty: 'easy',
                question: 'Carta palang menunjukkan markah tiga pelajar: Ali (80), Siti (65), dan Ahmad (90). Siapa mendapat markah tertinggi?',
                image: {
                    src: 'images/student-scores-bar-chart.png',
                    alt: 'Carta palang markah ujian tiga pelajar',
                    description: 'Carta palang menunjukkan skor ujian tiga pelajar: Ali (80 markah), Siti (65 markah), Ahmad (90 markah)'
                },
                answer: 'Ahmad',
                options: ['Ali', 'Siti', 'Ahmad', 'Sama markah'],
                explanation: 'Ahmad mendapat markah tertinggi iaitu 90 markah'
            },
            {
                id: 6,
                category: 'pictograph_calculation',
                difficulty: 'medium',
                question: 'Piktograf bunga ros menunjukkan 🌹🌹🌹🌹🌹 untuk merah dan 🌹🌹🌹 untuk putih. Jika setiap simbol = 8 tangkai, berapa jumlah bunga keseluruhan?',
                image: {
                    src: 'images/rose-flower-pictograph.png',
                    alt: 'Piktograf bunga ros mengikut warna',
                    description: 'Piktograf menunjukkan ros merah (5 simbol) dan ros putih (3 simbol), dengan legenda menunjukkan setiap simbol mewakili 8 tangkai bunga'
                },
                answer: '64 tangkai',
                options: ['56 tangkai', '64 tangkai', '72 tangkai', '48 tangkai'],
                explanation: 'Merah: 5 × 8 = 40, Putih: 3 × 8 = 24. Jumlah: 40 + 24 = 64 tangkai'
            },
            {
                id: 7,
                category: 'bar_chart_interpretation',
                difficulty: 'easy',
                question: 'Carta palang jualan ais krim: Vanila (25 unit), Coklat (30 unit), Strawberi (20 unit). Berapakah jumlah jualan keseluruhan?',
                image: {
                    src: 'images/ice-cream-sales-chart.png',
                    alt: 'Carta palang jualan ais krim mengikut perisa',
                    description: 'Carta palang menunjukkan jualan ais krim: Vanila (25 unit), Coklat (30 unit), Strawberi (20 unit)'
                },
                answer: '75 unit',
                options: ['70 unit', '75 unit', '80 unit', '85 unit'],
                explanation: '25 + 30 + 20 = 75 unit ais krim'
            },
            {
                id: 8,
                category: 'pictograph_percentage',
                difficulty: 'medium',
                question: 'Dalam piktograf 20 orang pelajar, jika 🧑🧑🧑🧑 suka matematik (setiap simbol = 1 orang), berapa peratus pelajar suka matematik?',
                image: {
                    src: 'images/math-students-pictograph.png',
                    alt: 'Piktograf pelajar yang suka matematik',
                    description: 'Piktograf menunjukkan 20 simbol pelajar dengan 4 yang diserlahkan sebagai suka matematik (pengiraan visual 20%)'
                },
                answer: '20%',
                options: ['15%', '20%', '25%', '30%'],
                explanation: '4 orang daripada 20 orang = 4/20 = 20%'
            },
            {
                id: 9,
                category: 'bar_chart_difference',
                difficulty: 'easy',
                question: 'Carta palang menunjukkan hujan: Januari (120mm), Februari (80mm), Mac (150mm). Berapa perbezaan hujan antara Mac dan Februari?',
                image: {
                    src: 'images/monthly-rainfall-chart.png',
                    alt: 'Carta palang taburan hujan',
                    description: 'Carta palang menunjukkan taburan hujan pada bulan Januari (120mm), Fbruari  (80mm) dan Mac (150mm)'
                },
                answer: '70mm',
                options: ['60mm', '70mm', '80mm', '90mm'],
                explanation: 'Mac - Februari = 150mm - 80mm = 70mm'
            },
            {
                id: 10,
                category: 'pictograph_symbols',
                difficulty: 'medium',
                question: 'Jika piktograf menunjukkan 36 ekor ayam menggunakan 9 simbol 🐔, berapa ekor ayam yang diwakili oleh setengah simbol?',
                answer: '2 ekor',
                options: ['1 ekor', '2 ekor', '3 ekor', '4 ekor'],
                explanation: '36 ÷ 9 = 4 ekor setiap simbol. Setengah simbol = 4 ÷ 2 = 2 ekor'
            },

            // Complex word problems (11-20)
            {
                id: 11,
                category: 'pictograph_analysis',
                difficulty: 'hard',
                question: 'Zikri menyiapkan piktograf bilangan buku yang dibaca oleh empat rakan. Sebanyak 48 buah buku telah dibaca oleh mereka. Berdasarkan piktograf yang ditunjukkan: a) Berapa bilangan simbol untuk mewakili buku Raveena? b) Kira peratus buku yang dibaca oleh Sherry.',
                subquestions: [
                    'a) Bilangan simbol untuk Raveena',
                    'b) Peratus buku dibaca oleh Sherry'
                ],
                image: {
                    src: 'images/books-read-pictograph.png',
                    alt: 'Piktograf bilangan buku yang dibaca',
                    description: 'Piktograf menunjukkan: Sherry (4 simbol buku), Qalisha (5 simbol buku), Swee Ping (4 simbol buku), Raveena (3 simbol buku). Setiap simbol mewakili 3 buah buku.'
                },
                answer: '3 simbol, 25%',
                options: ['2 simbol, 20%', '3 simbol, 25%', '4 simbol, 30%', '5 simbol, 35%'],
                explanation: 'a) Raveena ada 3 simbol. b) Sherry: 4×3=12 buku. Peratus: (12/48)×100% = 25%'
            },
            {
                id: 12,
                category: 'bar_chart_qualification',
                difficulty: 'hard',
                question: 'Carta palang tidak lengkap menunjukkan skor Zariq dalam ujian kemahiran bola baling. Syarat menjadi pemain sekolah: lulus ujian kemahiran dan dapat markah melebihi 45. Berjayakah Zariq dipilih jika dia dapat 8 markah untuk hantaran lantun?',
                image: {
                    src: 'images/zariq-sports-skills.png',
                    alt: 'Carta palang ujian kemahiran bola baling Zariq',
                    description: 'Carta palang menunjukkan skor Zariq: Lontar (8 markah), Sambut (10 markah), Halang (7 markah), Jaring (10 markah), Lantun (kosong - untuk diisi 8 markah)'
                },
                answer: 'Tidak berjaya',
                options: ['Tidak berjaya', 'Ya, berjaya', 'Data tidak mencukupi', 'Perlu ujian tambahan'],
                explanation: 'Jumlah markah: 8+10+7+10+8 = 43 markah. Kurang dari 45, jadi tidak berjaya dipilih.'
            },
            {
                id: 13,
                category: 'ball_sales_analysis',
                difficulty: 'hard',
                question: 'Kedai Sukan NDS menjual bola: Januari (10 biji), Februari (16 biji), Mac (12 biji), April (10 biji). Harga setiap bola RM50. a) Jumlah bola dua bulan pertama? b) Beza jualan Februari-April? c) Jumlah harga 4 bulan?',
                subquestions: [
                    'a) Jumlah bola Januari + Februari',
                    'b) Beza jualan Februari dengan April',
                    'c) Jumlah harga keseluruhan 4 bulan'
                ],
                image: {
                    src: 'images/ball-sales-chart.png',
                    alt: 'Carta jualan bola kedai sukan',
                    description: 'Carta palang menunjukkan jualan bola bulanan: Januari (10), Februari (16), Mac (12), April (10). Harga setiap bola RM50.'
                },
                answer: '26 biji, 6 biji, RM2400',
                options: ['24 biji, 5 biji, RM2200', '26 biji, 6 biji, RM2400', '28 biji, 7 biji, RM2600', '25 biji, 8 biji, RM2500'],
                explanation: 'a) 10+16=26 biji. b) 16-10=6 biji. c) Jumlah: 48 biji × RM50 = RM2400'
            },
            {
                id: 14,
                category: 'stamp_collection_analysis',
                difficulty: 'hard',
                question: 'Koleksi setem: Syahir  ada 30 keping, Francis 15 lebih dari Syahir, Rishi 10 kurang dari Francis, Xin Feng 10 lebih dari Syahir. Jawab soalan berikut:',
                subquestions: [
                    'a) Bilangan setem Francis, Rishi, Xin Feng',
                    'b) Jumlah setem keempat-empat mereka',
                    'c) Peratus setem yang dimiliki Syahir'
                ],
                answer: '45, 35, 40; 150 keping; 20%',
                options: ['40, 30, 35; 135 keping; 22%', '45, 35, 40; 150 keping; 20%', '50, 40, 45; 165 keping; 18%', '42, 32, 38; 142 keping; 21%'],
                explanation: 'a) Francis:45, Rishi:35, Xin Feng:40. b) 30+45+35+40=150. c) 30/150×100%=20%'
            },
            {
                id: 15,
                category: 'quiz_scores_comparison',
                difficulty: 'hard',
                question: 'Carta palang menunjukkan markah kuiz bagi empat pasukan. Setiap pasukan dapat 15 markah tambahan. Jawab soalan berikut: i) Senarai pasukan markah terkini >100. ii) Adakah jumlah markah terkini = 400?',
                subquestions: [
                    'a) Senaraikan pasukan markah dengan markah terkini >100',
                    'b) Adakah jumlah markah terkini = 400',
                ],
                image: {
                    src: 'images/team-quiz-scores.png',
                    alt: 'Carta palang markah kuiz empat pasukan',
                    description: 'Carta palang menunjukkan markah asal: Meranti (60), Jati (80), Seraya (70), Merbau (75). Setiap pasukan tambah 15 markah.'
                },
                answer: 'Jati, Merbau; Tidak, 415',
                options: ['Jati sahaja; Ya, 400', 'Jati, Merbau; Tidak, 415', 'Semua pasukan; Tidak, 420', 'Meranti, Jati; Ya, 400'],
                explanation: 'Markah terkini: Meranti(75), Jati(95), Seraya(85), Merbau(90). Tiada >100. Jumlah: 345+60=405'
            },
            {
                id: 16,
                category: 'fishing_competition_analysis',
                difficulty: 'hard',
                question: 'Piktograf pertandingan memancing 5 peserta. Jumlah ikan 34 ekor. Adin pemenang dengan 12 ekor. Setiap simbol = 2 ekor. i) Anggaran ikan Adin dari piktograf. ii) Buktikan Sam dan Tim sama bilangan ikan.',
                image: {
                    src: 'images/fishing-competition-pictograph.png',
                    alt: 'Piktograf pertandingan memancing',
                    description: 'Piktograf menunjukkan: Sam (2 simbol ikan), Adin (6 simbol ikan), Tim (2 simbol ikan), Ram (4 simbol ikan), Ong (3 simbol ikan). Setiap simbol = 2 ekor ikan.'
                },
                answer: '12 ekor; Ya, sama 4 ekor',
                options: ['10 ekor; Tidak sama', '12 ekor; Ya, sama 4 ekor', '14 ekor; Ya, sama 6 ekor', '8 ekor; Tidak sama'],
                explanation: 'i) Adin: 6 simbol × 2 = 12 ekor. ii) Sam: 2×2=4, Tim: 2×2=4. Sama bilangan.'
            },
            {
                id: 17,
                category: 'library_data_analysis',
                difficulty: 'hard',
                question: 'Lihat carta pai dan jawab soalan berikut:.',
                subquestions: [
                    'a) Jumlah pinjaman.',
                    'b) Perbezaan tertinggi-terendah.',
                    'c) Peratus buku Matematik.'
                ],
                image: {
                    src: 'images/library-book-loans.png',
                    alt: 'Data pinjaman buku perpustakaan mengikut subjek',
                    description: 'Carta palang menunjukkan pinjaman buku: Matematik (150), Sains (200), Sejarah (100), Bahasa (250)'
                },
                answer: '700 buku; 150 buku; 21.4%',
                options: ['650 buku; 120 buku; 23%', '700 buku; 150 buku; 21.4%', '750 buku; 180 buku; 20%', '680 buku; 140 buku; 22%'],
                explanation: 'a) 150+200+100+250=700. b) 250-100=150. c) 150/700×100%=21.4%'
            },
            {
                id: 18,
                category: 'temperature_data_analysis',
                difficulty: 'hard',
                question: 'Lihat carta palang di bawah dan jawab soalan berikut:',
                subquestions: [
                    'a) Purata suhu minggu.',
                    'b) Hari paling sejuk dan panas.',
                    'c) Julat suhu.'
                ],
                image: {
                    src: 'images/weekly-temperature-chart.png',
                    alt: 'Carta palang suhu harian selama seminggu',
                    description: 'Carta palang menunjukkan suhu: Isnin(32°C), Selasa(29°C), Rabu(35°C), Khamis(31°C), Jumaat(33°C), Sabtu(30°C), Ahad(28°C)'
                },
                answer: '31.1°C; Ahad, Rabu; 7°C',
                options: ['30.5°C; Selasa, Rabu; 6°C', '31.1°C; Ahad, Rabu; 7°C', '32°C; Ahad, Jumaat; 8°C', '29.8°C; Sabtu, Rabu; 5°C'],
                explanation: 'a) (32+29+35+31+33+30+28)÷7=31.1°C. b) Sejuk:Ahad(28°C), Panas:Rabu(35°C). c) 35-28=7°C'
            },
            {
                id: 19,
                category: 'school_transport_survey',
                difficulty: 'medium',
                question: 'Piktograf di bawah menunjukkan bancian cara pengankutan pelajar ke sekolah. Jawab soalan berikut:a) Buat piktograf (1 simbol = 20 pelajar). b) Mod pengangkutan popular. c) Peratus naik bas.',
                subquestions: [
                    'a) Apakah mod pengangkutan paling popular?',
                    'b) Berapa peratus pelajar menaiki bas?',
                ],
                image: {
                    src: 'images/school-transport-survey.png',
                    alt: 'Data pengangkutan pelajar ke sekolah',
                    description: 'Carta pai menunjukkan: Bas (180 pelajar), Kereta (120 pelajar), Berjalan kaki (60 pelajar), Basikal (40 pelajar) dari 400 pelajar'
                },
                answer: 'Bas; 45%',
                options: ['Kereta; 40%', 'Bas; 45%', 'Bas; 50%', 'Kereta; 35%'],
                explanation: 'a) Bas:9, Kereta:6, Berjalan:3, Basikal:2 simbol. b) Bas paling popular. c) 180/400×100%=45%'
            },
            {
                id: 20,
                category: 'fruit_sales_comprehensive',
                difficulty: 'hard',
                question: 'Jadual di bawah menunjukkan jualan buah-buahan di sebuah gerai. Jawab soalan berikut:a) Jumlah berat. b) Jualan tertinggi nilai. c) Purata harga per kg.',
                subquestions: [
                    'a) Berapa jumlah berat buah terjual?',
                    'b) Berapa nilai jualan tertinggi di kalangan buah-buahan?',
                    'c) Berapa purata hargua semua buah-buahan per kg?',
                ],
                image: {
                    src: 'images/fruit-sales-analysis.png',
                    alt: 'Data jualan dan harga buah-buahan',
                    description: 'Jadual menunjukkan jualan buah: Epal (45kg, RM8/kg), Oren (60kg, RM6/kg), Pisang (80kg, RM4/kg), Anggur (35kg, RM12/kg)'
                },
                answer: '220kg; Anggur RM420; RM7.50',
                options: ['210kg; Epal RM360; RM7.25', '220kg; Anggur RM420; RM7.50', '230kg; Pisang RM320; RM8.00', '200kg; Oren RM360; RM7.00'],
                explanation: 'a) 45+60+80+35=220kg. b) Nilai: Epal(RM360), Oren(RM360), Pisang(RM320), Anggur(RM420). c) (8+6+4+12)÷4=RM7.50'
            }
        ];

        // Achievement definitions for Data Management
        const achievementDefinitions = [
            { id: 'first_correct', name: 'Penganalisis Pertama!', description: 'Jawab soalan pertama dengan betul', icon: '🌟' },
            { id: 'streak_3', name: 'Pakar Data!', description: 'Jawab 3 soalan berturut-turut dengan betul', icon: '🔥' },
            { id: 'streak_5', name: 'Juara Statistik!', description: 'Jawab 5 soalan berturut-turut dengan betul', icon: '⚡' },
            { id: 'quick_thinker', name: 'Pemikir Pantas!', description: 'Jawab dalam 10 saat', icon: '💨' },
            { id: 'level_2', name: 'Naik Tahap!', description: 'Capai tahap 2', icon: '🎯' },
            { id: 'level_3', name: 'Pakar Pengurusan Data!', description: 'Capai tahap 3', icon: '👑' },
            { id: 'perfect_score', name: 'Sempurna!', description: 'Dapatkan 100% markah', icon: '🏆' },
            { id: 'high_scorer', name: 'Pencapai Tinggi!', description: 'Kumpul 500+ mata', icon: '💎' },
            { id: 'pictograph_master', name: 'Pakar Piktograf!', description: 'Jawab semua soalan piktograf dengan betul', icon: '📊' },
            { id: 'bar_chart_expert', name: 'Ahli Carta Palang!', description: 'Jawab semua soalan carta palang dengan betul', icon: '📈' },
            { id: 'data_analyst', name: 'Penganalisis Data!', description: 'Jawab semua soalan analisis dengan betul', icon: '🔍' },
            { id: 'word_problem_solver', name: 'Penyelesai Masalah!', description: 'Jawab semua masalah berayat dengan betul', icon: '📝' }
        ];

        // Game state
        let currentQuestion = 0;
        let score = 0;
        let points = 0;
        let streak = 0;
        let bestStreak = 0;
        let level = 1;
        let experience = 0;
        let timeLeft = 30;
        let timerInterval;
        let gameActive = true;
        let unlockedAchievements = [];
        let filteredQuestions = [];
        let categoryStats = {};

        // Shuffle array function for options only
        function shuffleOptions(question) {
            const correctAnswer = question.answer;
            const shuffledOptions = [...question.options];
            
            // Shuffle the options array
            for (let i = shuffledOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
            }
            
            return {
                ...question,
                options: shuffledOptions,
                answer: correctAnswer // Keep the correct answer unchanged
            };
        }

        // Initialize game
        function initGame() {
            console.log('Initializing game...');
            console.log('Questions array length:', questions.length);
            
            // Always use all questions, no filtering
            filteredQuestions = [...questions];
            console.log('Filtered questions length:', filteredQuestions.length);
            
            if (filteredQuestions.length > 0) {
                loadQuestion();
                startTimer();
                updateDisplays();
            } else {
                console.error('No questions available!');
            }
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120; // 2 minutes
            gameActive = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timerDisplay');
            const timerBar = document.getElementById('timerBar');
            const timerStat = document.getElementById('timerStat');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            timerEl.textContent = `⏰ ${timeText}`;
            timerStat.textContent = timeText;
            timerBar.style.width = `${(timeLeft / 120) * 100}%`;
            
            if (timeLeft <= 10) {
                timerEl.className = 'timer-display danger';
                timerBar.className = 'timer-fill danger';
                timerStat.style.color = '#f44336';
            } else if (timeLeft <= 30) {
                timerEl.className = 'timer-display warning';
                timerBar.className = 'timer-fill warning';
                timerStat.style.color = '#ff9800';
            } else {
                timerEl.className = 'timer-display';
                timerBar.className = 'timer-fill';
                timerStat.style.color = '#2196f3';
            }
        }

        // Points calculation
        function calculatePoints(difficulty, timeRemaining, isCorrect) {
            if (!isCorrect) return 0;
            
            let basePoints = 0;
            switch (difficulty) {
                case 'easy': basePoints = 10; break;
                case 'medium': basePoints = 20; break;
                case 'hard': basePoints = 30; break;
                default: basePoints = 15;
            }
            
            let timeBonus = timeRemaining > 60 ? 10 : timeRemaining > 30 ? 5 : 0;
            let streakMultiplier = Math.min(streak + 1, 3);
            
            return Math.round((basePoints + timeBonus) * streakMultiplier);
        }

        // Level and experience
        function updateLevel(newPoints) {
            const newExperience = experience + newPoints;
            const newLevel = Math.floor(newExperience / 100) + 1;
            
            if (newLevel > level) {
                checkAchievements('level', newLevel);
                showLevelUp(newLevel);
            }
            
            experience = newExperience;
            level = newLevel;
        }

        function showLevelUp(newLevel) {
            const levelEl = document.getElementById('levelDisplay');
            levelEl.style.animation = 'bounce 1s ease-out';
            setTimeout(() => {
                levelEl.style.animation = '';
            }, 1000);
        }

        // Achievement system
        function checkAchievements(type, value) {
            const newAchievements = [];
            
            switch (type) {
                case 'first_correct':
                    if (score === 0 && !unlockedAchievements.includes('first_correct')) {
                        newAchievements.push('first_correct');
                    }
                    break;
                case 'streak':
                    if (value >= 3 && !unlockedAchievements.includes('streak_3')) newAchievements.push('streak_3');
                    if (value >= 5 && !unlockedAchievements.includes('streak_5')) newAchievements.push('streak_5');
                    break;
                case 'quick_answer':
                    if (timeLeft > 90 && !unlockedAchievements.includes('quick_thinker')) {
                        newAchievements.push('quick_thinker');
                    }
                    break;
                case 'level':
                    if (value >= 2 && !unlockedAchievements.includes('level_2')) newAchievements.push('level_2');
                    if (value >= 3 && !unlockedAchievements.includes('level_3')) newAchievements.push('level_3');
                    break;
                case 'points':
                    if (value >= 500 && !unlockedAchievements.includes('high_scorer')) {
                        newAchievements.push('high_scorer');
                    }
                    break;
                case 'perfect':
                    if (!unlockedAchievements.includes('perfect_score')) {
                        newAchievements.push('perfect_score');
                    }
                    break;
                case 'category_master':
                    checkCategoryMaster(newAchievements);
                    break;
            }
            
            if (newAchievements.length > 0) {
                unlockedAchievements.push(...newAchievements);
                showAchievementPopup(newAchievements[0]);
            }
        }

        function checkCategoryMaster(newAchievements) {
            const pictographQuestions = questions.filter(q => q.category.includes('pictograph'));
            const barChartQuestions = questions.filter(q => q.category.includes('bar_chart'));
            const analysisQuestions = questions.filter(q => q.category.includes('analysis'));
            const wordProblemQuestions = questions.filter(q => q.id >= 11);
            
            if (!unlockedAchievements.includes('pictograph_master') && 
                pictographQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('pictograph_master');
            }
            
            if (!unlockedAchievements.includes('bar_chart_expert') && 
                barChartQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('bar_chart_expert');
            }
            
            if (!unlockedAchievements.includes('data_analyst') && 
                analysisQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('data_analyst');
            }

            if (!unlockedAchievements.includes('word_problem_solver') && 
                wordProblemQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('word_problem_solver');
            }
        }

        function showAchievementPopup(achievementId) {
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-popup-header">
                    <span style="font-size: 2em;">🏆</span>
                    <div>
                        <div style="font-weight: bold;">Pencapaian Baru!</div>
                        <div>${achievement.icon} ${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 3000);
        }

        // Question loading
        function loadQuestion() {
            if (currentQuestion >= filteredQuestions.length) {
                showResults();
                return;
            }
            
            // Get question and shuffle its options only
            const originalQ = filteredQuestions[currentQuestion];
            const currentQ = shuffleOptions(originalQ);
            
            // Format question with subquestions if available
            let questionHTML = currentQ.question;
            if (currentQ.subquestions) {
                questionHTML += '<br><br>';
                currentQ.subquestions.forEach(subq => {
                    questionHTML += subq + '<br>';
                });
            }
            
            document.getElementById('questionText').innerHTML = questionHTML;
            
            // Update difficulty and points badges
            const difficultyBadge = document.getElementById('difficultyBadge');
            const pointsBadge = document.getElementById('pointsBadge');
            const categoryBadge = document.getElementById('categoryBadge');
            
            const difficultyText = {
                'easy': 'Mudah',
                'medium': 'Sederhana', 
                'hard': 'Sukar'
            };
            
            const pointsText = {
                'easy': '10',
                'medium': '20',
                'hard': '30'
            };

            const categoryText = {
                'pictograph_basics': 'Asas Piktograf',
                'pictograph_interpretation': 'Tafsiran Piktograf',
                'pictograph_calculation': 'Pengiraan Piktograf',
                'pictograph_percentage': 'Peratus Piktograf',
                'pictograph_symbols': 'Simbol Piktograf',
                'pictograph_analysis': 'Analisis Piktograf',
                'bar_chart_reading': 'Bacaan Carta Palang',
                'bar_chart_comparison': 'Perbandingan Carta',
                'bar_chart_interpretation': 'Tafsiran Carta',
                'bar_chart_difference': 'Beza Carta Palang',
                'bar_chart_qualification': 'Kelayakan Carta',
                'ball_sales_analysis': 'Analisis Jualan',
                'stamp_collection_analysis': 'Analisis Koleksi',
                'quiz_scores_comparison': 'Perbandingan Markah',
                'fishing_competition_analysis': 'Analisis Pertandingan',
                'library_data_analysis': 'Data Perpustakaan',
                'temperature_data_analysis': 'Data Suhu',
                'school_transport_survey': 'Survei Pengangkutan',
                'fruit_sales_comprehensive': 'Analisis Jualan Buah'
            };
            
            difficultyBadge.textContent = difficultyText[currentQ.difficulty] || 'Sederhana';
            difficultyBadge.className = `difficulty-badge difficulty-${currentQ.difficulty || 'medium'}`;
            pointsBadge.textContent = `${pointsText[currentQ.difficulty] || '20'} mata`;
            categoryBadge.textContent = categoryText[currentQ.category] || 'Pengurusan Data';
            
            // Store the current question with shuffled options for answer checking
            window.currentQuestionData = currentQ;
            
            // Load image if present
            loadQuestionImage(currentQ);
            
            // Update options (now shuffled)
            loadOptions(currentQ);
            
            // Reset feedback and buttons
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('actionButtons').innerHTML = 
                '<button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>';
            
            // Start timer
            startTimer();
            updateDisplays();
        }

        function loadQuestionImage(question) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            container.style.display = 'none';
            
            if (question.image) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-container';
                
                if (question.image.src) {
                    const img = document.createElement('img');
                    img.src = question.image.src;
                    img.alt = question.image.alt;
                    img.onerror = function() {
                        imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                    };
                    imageDiv.appendChild(img);
                } else if (question.image.description) {
                    imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                }
                
                container.appendChild(imageDiv);
                container.style.display = 'block';
            }
        }

        function loadOptions(question) {
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-label">Pilihan ${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                btn.dataset.answer = option;
                btn.onclick = () => selectAnswer(option);
                container.appendChild(btn);
            });
        }

        // Answer selection
        function selectAnswer(answer) {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const isCorrect = answer === currentQ.answer;
            const earnedPoints = calculatePoints(currentQ.difficulty, timeLeft, isCorrect);
            
            // Track category performance using original question id
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = isCorrect;
            
            if (isCorrect) {
                const newScore = score + 1;
                const newStreak = streak + 1;
                const newPoints = points + earnedPoints;
                
                score = newScore;
                streak = newStreak;
                points = newPoints;
                bestStreak = Math.max(bestStreak, newStreak);
                
                updateLevel(earnedPoints);
                
                // Check achievements
                if (newScore === 1) checkAchievements('first_correct');
                checkAchievements('streak', newStreak);
                if (timeLeft > 90) checkAchievements('quick_answer');
                checkAchievements('points', newPoints);
                checkAchievements('category_master');
                
                showFeedback(true, earnedPoints, currentQ.explanation);
            } else {
                streak = 0;
                showFeedback(false, 0, `Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            }
            
            highlightAnswers(answer, isCorrect);
            updateDisplays();
            
            // Check for perfect score
            if (currentQuestion === filteredQuestions.length - 1 && isCorrect && score === filteredQuestions.length) {
                checkAchievements('perfect');
            }
        }

        function skipQuestion() {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            streak = 0;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = false;
            
            showFeedback(false, 0, `Soalan dilangkau. Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            highlightCorrectAnswer();
            updateDisplays();
        }

        // Feedback display
        function showFeedback(isCorrect, earnedPoints, explanation) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            feedbackEl.className = `feedback ${isCorrect ? 'correct' : 'wrong'} show`;
            
            const icon = isCorrect ? '✅' : '❌';
            const title = isCorrect ? `Betul! +${earnedPoints} mata!` : 'Tidak betul.';
            const bonus = (isCorrect && timeLeft > 90) ? '<br><span style="color: #ff9800;">⚡ Bonus Pantas!</span>' : '';
            
            feedbackEl.innerHTML = `
                <div class="feedback-header">
                    <span class="feedback-icon">${icon}</span>
                    <span>${title}${bonus}</span>
                </div>
                <div class="feedback-explanation">${explanation}</div>
            `;
            
            // Update action buttons
            const actionButtons = document.getElementById('actionButtons');
            if (currentQuestion < filteredQuestions.length - 1) {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="nextQuestion()">Seterusnya</button>';
            } else {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="showResults()">Selesai</button>';
            }
        }

        // Answer highlighting
        function highlightAnswers(selectedAnswer, isCorrect) {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else if (optionText === selectedAnswer && !isCorrect) {
                    btn.className = 'option-btn wrong';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        function highlightCorrectAnswer() {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        // Navigation
        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // Display updates
        function updateDisplays() {
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${filteredQuestions.length}`;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('pointsDisplay').textContent = points;
            document.getElementById('streakDisplay').textContent = streak;
            document.getElementById('levelDisplay').textContent = level;
            
            const progressPercent = ((currentQuestion + 1) / filteredQuestions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progressPercent}%`;
            progressFill.textContent = `${Math.round(progressPercent)}%`;
            
            const expPercent = ((experience % 100) / 100) * 100;
            const expFill = document.getElementById('expFill');
            expFill.style.width = `${expPercent}%`;
            document.getElementById('expLabel').textContent = `Pengalaman: ${experience} / ${level * 100}`;
        }

        // Results screen
        function showResults() {
            const gameArea = document.getElementById('gameArea');
            const percentage = Math.round((score / filteredQuestions.length) * 100);
            
            let message = '';
            if (percentage === 100) message = 'SEMPURNA! Pakar Pengurusan Data! 📊👑';
            else if (percentage >= 90) message = 'Cemerlang Sekali! 🌟🏆';
            else if (percentage >= 80) message = 'Cemerlang! 🌟';
            else if (percentage >= 70) message = 'Bagus Sekali! 👍✨';
            else if (percentage >= 60) message = 'Bagus! 👍';
            else if (percentage >= 50) message = 'Boleh Tahan! 💪';
            else message = 'Cuba Lagi! Jangan Putus Asa! 🤗';
            
            let achievementsHTML = '';
            if (unlockedAchievements.length > 0) {
                achievementsHTML = `
                    <div class="achievements-section">
                        <h3>🏆 Pencapaian</h3>
                        <div class="achievements-grid">
                            ${unlockedAchievements.map(id => {
                                const achievement = achievementDefinitions.find(a => a.id === id);
                                return achievement ? `
                                    <div class="achievement-badge">
                                        <div class="achievement-icon">${achievement.icon}</div>
                                        <div class="achievement-name">${achievement.name}</div>
                                    </div>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            gameArea.innerHTML = `
                <div class="complete-screen">
                    <div class="trophy-animation">🏆</div>
                    <h2 style="color: #e65100; margin-bottom: 30px;">Tahniah!</h2>
                    
                    <div class="final-stats">
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #e65100;">${score}/${filteredQuestions.length}</div>
                            <div class="final-stat-label">Soalan Betul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #4caf50;">${points}</div>
                            <div class="final-stat-label">Mata Dikumpul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ff9800;">${bestStreak}</div>
                            <div class="final-stat-label">Berturut Terbaik</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ff8a50;">${level}</div>
                            <div class="final-stat-label">Tahap Dicapai</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Peratusan: ${percentage}%</div>
                    <div style="font-size: 1.8em; color: #4caf50; margin-bottom: 30px; font-weight: bold;">${message}</div>
                    
                    ${achievementsHTML}
                    
                    <div class="action-buttons" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="restartGame()" style="font-size: 1.2em; padding: 15px 30px; margin-right: 15px;">
                            🔄 Main Lagi
                        </button>
                        <button class="btn btn-back" onclick="goBack()" style="font-size: 1.2em; padding: 15px 30px;">
                            ← Halaman Utama
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('timerDisplay').style.display = 'none';
        }

        // Game restart
        function restartGame() {
            currentQuestion = 0;
            score = 0;
            points = 0;
            streak = 0;
            level = 1;
            experience = 0;
            unlockedAchievements = [];
            categoryStats = {};
            
            document.getElementById('timerDisplay').style.display = 'block';
            filteredQuestions = [...questions];
            loadQuestion();
        }

        // Navigation functions
        function goBack() {
            window.location.href = '../';
        }

        // Initialize the game
        initGame();
    </script>
</body>
</html>
