<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panjang, Jisim dan Isipadu - Math Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fff8e1 0%, #fffde7 50%, #f9fbe7 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #f57f17;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #fff8e1;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .experience-bar {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .exp-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .exp-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #f57f17, #ffb300);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .progress-section {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f57f17, #8bc34a);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .timer-fill {
            height: 100%;
            width: 100%;
            transition: all 1s linear;
            background: #8bc34a;
        }
        
        .timer-fill.warning {
            background: #ff9800;
        }
        
        .timer-fill.danger {
            background: #f44336;
            animation: pulse-timer 0.5s infinite alternate;
        }
        
        @keyframes pulse-timer {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }
        
        .question-card {
            background: #fafafa;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            margin-bottom: 20px;
            position: relative;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .question-content {
            flex: 1;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .image-container {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .image-fallback {
            background: #fff8e1;
            padding: 20px;
            border-radius: 8px;
            color: #f57f17;
            font-weight: 500;
        }
        
        .difficulty-badges {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 20px;
        }
        
        .difficulty-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-align: center;
        }
        
        .difficulty-easy { background: #e8f5e9; color: #2e7d32; }
        .difficulty-medium { background: #fff3e0; color: #f57c00; }
        .difficulty-hard { background: #ffebee; color: #c62828; }
        
        .points-badge {
            background: #fff8e1;
            color: #f57f17;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .category-badge {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            padding: 20px;
            border: 2px solid #f57f17;
            border-radius: 12px;
            background: #fffef7;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
            position: relative;
            transform-origin: center;
        }
        
        .option-btn:hover:not(:disabled) {
            background: #fff8e1;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(245, 127, 23, 0.15);
        }
        
        .option-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .option-text {
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .option-btn.correct {
            background: #8bc34a;
            color: white;
            border-color: #8bc34a;
            animation: correctPulse 0.6s ease-out;
        }
        
        .option-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: wrongShake 0.5s ease-out;
        }
        
        .option-btn.disabled {
            background: #f0f0f0;
            color: #999;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback {
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .feedback::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .feedback.show::before {
            left: 100%;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #2e7d32;
            border-color: #8bc34a;
        }
        
        .feedback.wrong {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: #c62828;
            border-color: #f44336;
        }
        
        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .feedback-icon {
            font-size: 1.5em;
        }
        
        .feedback-explanation {
            font-weight: normal;
            line-height: 1.5;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f57f17, #ff9800);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 127, 23, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(245, 127, 23, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #757575, #616161);
            color: white;
            box-shadow: 0 4px 15px rgba(117, 117, 117, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(117, 117, 117, 0.4);
        }
        
        .btn-back {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            border: 2px solid transparent;
        }
        
        .btn-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            border-color: #495057;
        }
        
        .back-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
        }
        
        .timer-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-weight: bold;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .timer-display.warning {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
            animation: pulse 2s infinite;
        }
        
        .timer-display.danger {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: urgentPulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes urgentPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.1) rotate(2deg); }
        }
        
        .complete-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .trophy-animation {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .final-stat {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .final-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .final-stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .achievements-section {
            margin-top: 30px;
            text-align: left;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #ffb300, #ffc947);
            color: #e65100;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #ffb300;
            animation: achievementGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes achievementGlow {
            from { box-shadow: 0 4px 15px rgba(255, 179, 0, 0.3); }
            to { box-shadow: 0 8px 25px rgba(255, 179, 0, 0.6); }
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-popup {
            position: fixed;
            top: 70px;
            right: 10px;
            background: #ffb300;
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(255, 179, 0, 0.4);
            z-index: 1001;
            animation: slideInBounce 0.6s ease-out;
            border: 2px solid #ffc947;
            max-width: 250px;
        }
        
        @keyframes slideInBounce {
            0% { transform: translateX(400px); opacity: 0; }
            60% { transform: translateX(-20px); opacity: 1; }
            100% { transform: translateX(0); }
        }
        
        .achievement-popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #f57f17;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: 500;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #fff8e1;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .main-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                position: fixed;
                top: 5px;
                right: 5px;
                padding: 8px 15px;
                font-size: 1em;
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .achievement-popup {
                top: 55px;
                right: 5px;
                left: 5px;
                max-width: none;
                padding: 12px;
            }
            
            .difficulty-badges {
                flex-direction: row;
                margin-left: 0;
                margin-top: 15px;
            }
            
            .question-header {
                flex-direction: column;
            }
            
            .final-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            body {
                padding: 10px 5px 5px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="timer-display" id="timerDisplay">⏰ 2:00</div>
    
    <div class="back-button-container">
        <button class="btn btn-back" onclick="goBack()">
            ← Kembali
        </button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">📏 Panjang, Jisim dan Isipadu</h1>
            <p class="subtitle">Permainan Matematik Interaktif - Berdasarkan Lembaran Kerja Sebenar</p>
        </div>

        <div class="main-stats">
            <div class="stat-box">
                <div class="stat-number" id="questionCounter" style="color: #f57f17;">1/20</div>
                <div class="stat-label">Soalan</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="scoreDisplay" style="color: #8bc34a;">0</div>
                <div class="stat-label">Skor</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="pointsDisplay" style="color: #2e7d32;">0</div>
                <div class="stat-label">Mata</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="streakDisplay" style="color: #ff9800;">0</div>
                <div class="stat-label">Berturut</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="levelDisplay" style="color: #ffb300;">1</div>
                <div class="stat-label">Tahap</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="timerStat" style="color: #2196f3;">2:00</div>
                <div class="stat-label">Masa</div>
            </div>
        </div>

        <div class="experience-bar">
            <div class="exp-label" id="expLabel">Pengalaman: 0 / 100</div>
            <div class="exp-bar">
                <div class="exp-fill" id="expFill"></div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">5%</div>
            </div>
            <div class="timer-bar">
                <div class="timer-fill" id="timerBar"></div>
            </div>
        </div>

        <div id="gameArea">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-content">
                        <div class="question-text" id="questionText">
                            Loading question...
                        </div>
                        <div id="imageContainer"></div>
                    </div>
                    <div class="difficulty-badges">
                        <div class="difficulty-badge" id="difficultyBadge">Sederhana</div>
                        <div class="points-badge" id="pointsBadge">20 mata</div>
                        <div class="category-badge" id="categoryBadge">Topik</div>
                    </div>
                </div>
                
                <div class="options" id="optionsContainer">
                    <!-- Options will be populated by JavaScript -->
                </div>

                <div id="feedback" style="display: none;"></div>
                
                <div class="action-buttons" id="actionButtons">
                    <button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All 20 questions from the worksheet - with randomized answer positions
        const questions = [
            // Short calculation questions (1-10)
            {
                id: 1,
                category: 'measurement_units',
                difficulty: 'easy',
                question: 'Tukar 65 mm kepada cm dan mm.',
                answer: '6 cm 5 mm',
                options: ['5 cm 6 mm', '6 cm 5 mm', '6 cm 15 mm', '65 cm 0 mm'],
                explanation: '65 mm = 6 cm 5 mm (60 mm = 6 cm, baki 5 mm)'
            },
            {
                id: 2,
                category: 'measurement_units',
                difficulty: 'easy',
                question: 'Tukar 13 cm 2 mm kepada mm.',
                answer: '132 mm',
                options: ['130 mm', '132 mm', '135 mm', '1320 mm'],
                explanation: '13 cm 2 mm = (13 × 10) + 2 = 130 + 2 = 132 mm'
            },
            {
                id: 3,
                category: 'length_operations',
                difficulty: 'medium',
                question: 'Kira: 12 cm 3 mm + 7 cm 2 mm + 6 cm 9 mm',
                answer: '26 cm 4 mm',
                options: ['25 cm 14 mm', '26 cm 4 mm', '25 cm 4 mm', '26 cm 14 mm'],
                explanation: '12 + 7 + 6 = 25 cm, 3 + 2 + 9 = 14 mm = 1 cm 4 mm, jadi 26 cm 4 mm'
            },
            {
                id: 4,
                category: 'length_operations',
                difficulty: 'medium',
                question: 'Kira: 36 cm 2 mm - 29 cm 9 mm',
                answer: '6 cm 3 mm',
                options: ['7 cm 3 mm', '6 cm 7 mm', '6 cm 3 mm', '7 cm 7 mm'],
                explanation: '36 cm 2 mm = 35 cm 12 mm. 35 - 29 = 6 cm, 12 - 9 = 3 mm'
            },
            {
                id: 5,
                category: 'length_operations',
                difficulty: 'medium',
                question: 'Kira: 3 × 25 cm 8 mm',
                answer: '77 cm 4 mm',
                options: ['75 cm 24 mm', '77 cm 4 mm', '76 cm 14 mm', '78 cm 4 mm'],
                explanation: '3 × 25 = 75 cm, 3 × 8 = 24 mm = 2 cm 4 mm, jadi 77 cm 4 mm'
            },
            {
                id: 6,
                category: 'mass_operations',
                difficulty: 'medium',
                question: 'Kira: 28 kg 833 g + 19 kg 110 g - 14 kg 495 g',
                answer: '33 kg 448 g',
                options: ['33 kg 448 g', '32 kg 548 g', '34 kg 348 g', '33 kg 548 g'],
                explanation: '28 + 19 = 47 kg, 833 + 110 = 943 g. 47 kg 943 g - 14 kg 495 g = 33 kg 448 g'
            },
            {
                id: 7,
                category: 'volume_operations',
                difficulty: 'medium',
                question: 'Kira: 5 ℓ 245 mℓ + 36 ℓ 973 mℓ - 8 ℓ',
                answer: '34 ℓ 218 mℓ',
                options: ['33 ℓ 218 mℓ', '34 ℓ 218 mℓ', '34 ℓ 318 mℓ', '35 ℓ 118 mℓ'],
                explanation: '5 + 36 - 8 = 33 ℓ, 245 + 973 = 1218 mℓ = 1 ℓ 218 mℓ, jadi 34 ℓ 218 mℓ'
            },
            {
                id: 8,
                category: 'length_operations',
                difficulty: 'medium',
                question: 'Kira: 49 cm 6 mm ÷ 8',
                answer: '62 mm',
                options: ['61 mm', '62 mm', '63 mm', '6 cm 2 mm'],
                explanation: '49 cm 6 mm = 496 mm. 496 ÷ 8 = 62 mm'
            },
            {
                id: 9,
                category: 'mass_operations',
                difficulty: 'medium',
                question: 'Kira: 48 kg 440 g × 2 ÷ 8',
                answer: '12 kg 110 g',
                options: ['12 kg 110 g', '12 kg 220 g', '11 kg 110 g', '13 kg 110 g'],
                explanation: '48 kg 440 g × 2 = 96 kg 880 g. 96 kg 880 g ÷ 8 = 12 kg 110 g'
            },
            {
                id: 10,
                category: 'volume_operations',
                difficulty: 'hard',
                question: 'Kira: 9 × 6 ℓ 455 mℓ ÷ 3',
                answer: '19365 mℓ',
                options: ['19365 mℓ', '19 ℓ 365 mℓ', '18365 mℓ', '20365 mℓ'],
                explanation: '6 ℓ 455 mℓ × 9 = 58095 mℓ. 58095 ÷ 3 = 19365 mℓ'
            },

            // Word problems with images (11-20)
            {
                id: 11,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Puan Hamidah menggunakan reben merah jambu, putih dan hitam untuk menghias hadiah hari jadi anaknya. Panjang reben adalah seperti berikut: Hitam: 36 cm 3 mm, Merah jambu: 67 cm 2 mm, Putih: 268 mm. Berapakah jumlah panjang reben, dalam mm, yang digunakan?',
                image: {
                    src: 'images/ribbon-decoration.png',
                    alt: 'Puan Hamidah menggunakan reben untuk menghias hadiah',
                    description: 'Gambar menunjukkan Puan Hamidah dengan reben berwarna hitam (36 cm 3 mm), merah jambu (67 cm 2 mm), dan putih (268 mm) untuk menghias hadiah hari jadi'
                },
                answer: '1037 mm',
                options: ['1027 mm', '1037 mm', '1047 mm', '1057 mm'],
                explanation: '36 cm 3 mm = 363 mm, 67 cm 2 mm = 672 mm, 268 mm = 268 mm. Jumlah: 363 + 672 + 268 = 1037 mm'
            },
            {
                id: 12,
                category: 'word_problems',
                difficulty: 'medium',
                question: 'Encik Kimbua membuat latihan larian sejauh 3 km 260 m setiap hari. Hitung jarak lariannya dalam seminggu.',
                image: {
                    src: 'images/running-exercise.png',
                    alt: 'Encik Kimbua berlari setiap hari',
                    description: 'Gambar menunjukkan Encik Kimbua berlari di taman dengan jarak 3 km 260 m setiap hari'
                },
                answer: '22 km 820 m',
                options: ['22 km 720 m', '22 km 820 m', '23 km 820 m', '21 km 820 m'],
                explanation: '7 hari × 3 km 260 m = 7 × 3 km + 7 × 260 m = 21 km + 1820 m = 22 km 820 m'
            },
            {
                id: 13,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Berdasarkan maklumat dalam jadual: Sungai Pahang kurang 88 km daripada Sungai Rajang, Sungai Rajang lebih 323 km daripada Sungai Kelantan, Sungai Kelantan 240 km. Berapakah panjang Sungai Pahang?',
                image: {
                    src: 'images/river-lengths-table.png',
                    alt: 'Jadual panjang sungai-sungai di Malaysia',
                    description: 'Jadual menunjukkan hubungan panjang antara Sungai Pahang, Rajang dan Kelantan dengan data: Kelantan 240 km, Rajang lebih 323 km dari Kelantan, Pahang kurang 88 km dari Rajang'
                },
                answer: '475 km',
                options: ['465 km', '475 km', '485 km', '495 km'],
                explanation: 'Kelantan = 240 km, Rajang = 240 + 323 = 563 km, Pahang = 563 - 88 = 475 km'
            },
            {
                id: 14,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Jumlah jisim Maniam, Norzi dan Ong ialah 150 kg. Jisim Norzi 35 kg 200 g. Jisim Ong lebih 950 g daripada Norzi. Berapakah jisim Maniam?',
                image: {
                    src: 'images/three-people-mass.png',
                    alt: 'Tiga orang: Maniam, Norzi dan Ong',
                    description: 'Gambar menunjukkan tiga orang dengan maklumat jisim: Jumlah ketiga-tiganya 150 kg, Norzi 35 kg 200 g, Ong lebih 950 g dari Norzi'
                },
                answer: '77 kg 850 g',
                options: ['77 kg 850 g', '78 kg 850 g', '76 kg 850 g', '77 kg 950 g'],
                explanation: 'Norzi = 35 kg 200 g, Ong = 35 kg 200 g + 950 g = 36 kg 150 g. Maniam = 150 kg - 35 kg 200 g - 36 kg 150 g = 78 kg 650 g'
            },
            {
                id: 15,
                category: 'word_problems',
                difficulty: 'medium',
                question: 'Ayam belanda beratnya 4 kg 600 g. Ayam kampung kurang 2 kg 100 g daripada ayam belanda. Kira jumlah jisim ayam belanda dan ayam kampung.',
                image: {
                    src: 'images/two-chickens-weight.png',
                    alt: 'Ayam belanda dan ayam kampung',
                    description: 'Gambar menunjukkan ayam belanda (4 kg 600 g) dan ayam kampung yang lebih ringan 2 kg 100 g dari ayam belanda'
                },
                answer: '7 kg 100 g',
                options: ['7 kg 100 g', '7 kg 200 g', '6 kg 100 g', '8 kg 100 g'],
                explanation: 'Ayam belanda = 4 kg 600 g, Ayam kampung = 4 kg 600 g - 2 kg 100 g = 2 kg 500 g. Jumlah = 4 kg 600 g + 2 kg 500 g = 7 kg 100 g'
            },
            {
                id: 16,
                category: 'word_problems',
                difficulty: 'medium',
                question: 'Jisim 5 biji bola besi yang sama ialah 8 kg. Hitung jisim, dalam kg dan g, 4 biji bola besi itu.',
                image: {
                    src: 'images/iron-balls.png',
                    alt: 'Bola-bola besi',
                    description: 'Gambar menunjukkan 5 biji bola besi yang sama dengan jumlah jisim 8 kg, dan 4 biji bola besi lain'
                },
                answer: '6 kg 400 g',
                options: ['6 kg 200 g', '6 kg 400 g', '6 kg 500 g', '7 kg 200 g'],
                explanation: 'Jisim 1 bola = 8 kg ÷ 5 = 1 kg 600 g = 1600 g. Jisim 4 bola = 4 × 1600 g = 6400 g = 6 kg 400 g'
            },
            {
                id: 17,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Isi padu air di dalam bekas P kurang 395 mℓ daripada bekas Q. Isi padu air di dalam bekas Q ialah 1 ℓ 70 mℓ. a) Hitung jumlah isi padu air di dalam bekas P dan Q. b) Air di dalam bekas Q dituang sama banyak ke dalam 2 biji cawan. Berapakah isi padu air di dalam sebiji cawan?',
                image: {
                    src: 'images/containers-p-q-water.png',
                    alt: 'Bekas P dan Q berisi air',
                    description: 'Gambar menunjukkan bekas P dan bekas Q berisi air, dengan bekas Q mengandungi 1 ℓ 70 mℓ air, dan bekas P kurang 395 mℓ dari bekas Q'
                },
                answer: '1745 mℓ, 535 mℓ',
                options: ['1745 mℓ, 535 mℓ', '1645 mℓ, 535 mℓ', '1745 mℓ, 635 mℓ', '1845 mℓ, 535 mℓ'],
                explanation: 'Q = 1070 mℓ, P = 1070 - 395 = 675 mℓ. a) Jumlah = 1070 + 675 = 1745 mℓ. b) 1070 ÷ 2 = 535 mℓ'
            },
            {
                id: 18,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Jadual menunjukkan panjang tiga utas dawai K, L dan M. K: 27 cm 6 mm, L: 5 cm 4 mm lebih daripada K, M: 3 cm 8 mm lebih daripada L. Cari panjang, dalam cm dan mm, dawai M.',
                image: {
                    src: 'images/three-wires-table.png',
                    alt: 'Jadual panjang dawai K, L dan M',
                    description: 'Jadual menunjukkan panjang dawai: K = 27 cm 6 mm, L = 5 cm 4 mm lebih dari K, M = 3 cm 8 mm lebih dari L'
                },
                answer: '36 cm 8 mm',
                options: ['35 cm 18 mm', '36 cm 8 mm', '36 cm 18 mm', '35 cm 8 mm'],
                explanation: 'K = 27 cm 6 mm, L = 27 cm 6 mm + 5 cm 4 mm = 33 cm 0 mm, M = 33 cm 0 mm + 3 cm 8 mm = 36 cm 8 mm'
            },
            {
                id: 19,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Kim Leng memandu kereta ke Pusat Sains Negara sejauh 13 km. Keretanya rosak setelah memandu sejauh 2 km 50 m. Berapakah baki jarak, dalam m, yang perlu dilaluinya?',
                image: {
                    src: 'images/kim-leng-driving-route.png',
                    alt: 'Perjalanan Kim Leng ke Pusat Sains Negara',
                    description: 'Peta menunjukkan perjalanan Kim Leng dari rumah ke Pusat Sains Negara (13 km), dengan kereta rosak selepas 2 km 50 m'
                },
                answer: '10950 m',
                options: ['10850 m', '10950 m', '11050 m', '10750 m'],
                explanation: 'Jarak total = 13 km = 13000 m. Sudah dilalui = 2 km 50 m = 2050 m. Baki = 13000 - 2050 = 10950 m'
            },
            {
                id: 20,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Kamala memandu dari A ke C mengikut jalan paling dekat (15 km 97 m) dan pulang mengikut jalan paling jauh melalui B dan D. Jalan dari A-B = 7 km 65 m, B-D = 9 km 580 m, D-C = 10 km 564 m. Hitung jumlah jarak, dalam km, yang dilalui oleh Kamala.',
                image: {
                    src: 'images/kamala-route-map.png',
                    alt: 'Peta jalan Kamala dari A ke C',
                    description: 'Peta menunjukkan laluan Kamala: jalan terus A-C (15 km 97 m), dan laluan panjang melalui A-B-D-C dengan jarak masing-masing 7 km 65 m, 9 km 580 m, 10 km 564 m'
                },
                answer: '42 km 306 m',
                options: ['41 km 306 m', '42 km 306 m', '43 km 306 m', '42 km 206 m'],
                explanation: 'Pergi A-C = 15 km 97 m. Balik A-B-D-C = 7 km 65 m + 9 km 580 m + 10 km 564 m = 27 km 209 m. Jumlah = 15 km 97 m + 27 km 209 m = 42 km 306 m'
            }
        ];

        // Achievement definitions
        const achievementDefinitions = [
            { id: 'first_correct', name: 'Permulaan Hebat!', description: 'Jawab soalan pertama dengan betul', icon: '🌟' },
            { id: 'streak_3', name: 'Dalam Rentak!', description: 'Jawab 3 soalan berturut-turut dengan betul', icon: '🔥' },
            { id: 'streak_5', name: 'Hebat Sungguh!', description: 'Jawab 5 soalan berturut-turut dengan betul', icon: '⚡' },
            { id: 'quick_thinker', name: 'Pemikir Pantas!', description: 'Jawab dalam 10 saat', icon: '💨' },
            { id: 'level_2', name: 'Naik Tahap!', description: 'Capai tahap 2', icon: '🎯' },
            { id: 'level_3', name: 'Pakar Matematik!', description: 'Capai tahap 3', icon: '👑' },
            { id: 'perfect_score', name: 'Sempurna!', description: 'Dapatkan 100% markah', icon: '🏆' },
            { id: 'high_scorer', name: 'Pencapai Tinggi!', description: 'Kumpul 500+ mata', icon: '💎' },
            { id: 'length_master', name: 'Pakar Panjang!', description: 'Jawab semua soalan panjang dengan betul', icon: '📏' },
            { id: 'mass_expert', name: 'Ahli Jisim!', description: 'Jawab semua soalan jisim dengan betul', icon: '⚖️' },
            { id: 'volume_pro', name: 'Pro Isipadu!', description: 'Jawab semua soalan isipadu dengan betul', icon: '🥤' },
            { id: 'word_problem_solver', name: 'Penyelesai Masalah!', description: 'Jawab semua masalah berayat dengan betul', icon: '📝' }
        ];

        // Game state
        let currentQuestion = 0;
        let score = 0;
        let points = 0;
        let streak = 0;
        let bestStreak = 0;
        let level = 1;
        let experience = 0;
        let timeLeft = 30;
        let timerInterval;
        let gameActive = true;
        let unlockedAchievements = [];
        let filteredQuestions = [];
        let categoryStats = {};

        // Shuffle array function for options only
        function shuffleOptions(question) {
            const correctAnswer = question.answer;
            const shuffledOptions = [...question.options];
            
            // Shuffle the options array
            for (let i = shuffledOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
            }
            
            return {
                ...question,
                options: shuffledOptions,
                answer: correctAnswer // Keep the correct answer unchanged
            };
        }

        // Initialize game
        function initGame() {
            console.log('Initializing game...');
            console.log('Questions array length:', questions.length);
            
            // Always use all questions, no filtering
            filteredQuestions = [...questions];
            console.log('Filtered questions length:', filteredQuestions.length);
            
            if (filteredQuestions.length > 0) {
                loadQuestion();
                startTimer();
                updateDisplays();
            } else {
                console.error('No questions available!');
            }
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120; // 2 minutes
            gameActive = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timerDisplay');
            const timerBar = document.getElementById('timerBar');
            const timerStat = document.getElementById('timerStat');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            timerEl.textContent = `⏰ ${timeText}`;
            timerStat.textContent = timeText;
            timerBar.style.width = `${(timeLeft / 120) * 100}%`;
            
            if (timeLeft <= 10) {
                timerEl.className = 'timer-display danger';
                timerBar.className = 'timer-fill danger';
                timerStat.style.color = '#f44336';
            } else if (timeLeft <= 30) {
                timerEl.className = 'timer-display warning';
                timerBar.className = 'timer-fill warning';
                timerStat.style.color = '#ff9800';
            } else {
                timerEl.className = 'timer-display';
                timerBar.className = 'timer-fill';
                timerStat.style.color = '#2196f3';
            }
        }

        // Points calculation
        function calculatePoints(difficulty, timeRemaining, isCorrect) {
            if (!isCorrect) return 0;
            
            let basePoints = 0;
            switch (difficulty) {
                case 'easy': basePoints = 10; break;
                case 'medium': basePoints = 20; break;
                case 'hard': basePoints = 30; break;
                default: basePoints = 15;
            }
            
            let timeBonus = timeRemaining > 60 ? 10 : timeRemaining > 30 ? 5 : 0;
            let streakMultiplier = Math.min(streak + 1, 3);
            
            return Math.round((basePoints + timeBonus) * streakMultiplier);
        }

        // Level and experience
        function updateLevel(newPoints) {
            const newExperience = experience + newPoints;
            const newLevel = Math.floor(newExperience / 100) + 1;
            
            if (newLevel > level) {
                checkAchievements('level', newLevel);
                showLevelUp(newLevel);
            }
            
            experience = newExperience;
            level = newLevel;
        }

        function showLevelUp(newLevel) {
            const levelEl = document.getElementById('levelDisplay');
            levelEl.style.animation = 'bounce 1s ease-out';
            setTimeout(() => {
                levelEl.style.animation = '';
            }, 1000);
        }

        // Achievement system
        function checkAchievements(type, value) {
            const newAchievements = [];
            
            switch (type) {
                case 'first_correct':
                    if (score === 0 && !unlockedAchievements.includes('first_correct')) {
                        newAchievements.push('first_correct');
                    }
                    break;
                case 'streak':
                    if (value >= 3 && !unlockedAchievements.includes('streak_3')) newAchievements.push('streak_3');
                    if (value >= 5 && !unlockedAchievements.includes('streak_5')) newAchievements.push('streak_5');
                    break;
                case 'quick_answer':
                    if (timeLeft > 90 && !unlockedAchievements.includes('quick_thinker')) {
                        newAchievements.push('quick_thinker');
                    }
                    break;
                case 'level':
                    if (value >= 2 && !unlockedAchievements.includes('level_2')) newAchievements.push('level_2');
                    if (value >= 3 && !unlockedAchievements.includes('level_3')) newAchievements.push('level_3');
                    break;
                case 'points':
                    if (value >= 500 && !unlockedAchievements.includes('high_scorer')) {
                        newAchievements.push('high_scorer');
                    }
                    break;
                case 'perfect':
                    if (!unlockedAchievements.includes('perfect_score')) {
                        newAchievements.push('perfect_score');
                    }
                    break;
                case 'category_master':
                    checkCategoryMaster(newAchievements);
                    break;
            }
            
            if (newAchievements.length > 0) {
                unlockedAchievements.push(...newAchievements);
                showAchievementPopup(newAchievements[0]);
            }
        }

        function checkCategoryMaster(newAchievements) {
            const lengthQuestions = questions.filter(q => q.category === 'measurement_units' || q.category === 'length_operations');
            const massQuestions = questions.filter(q => q.category === 'mass_operations');
            const volumeQuestions = questions.filter(q => q.category === 'volume_operations');
            const wordProblemQuestions = questions.filter(q => q.category === 'word_problems');
            
            if (!unlockedAchievements.includes('length_master') && 
                lengthQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('length_master');
            }
            
            if (!unlockedAchievements.includes('mass_expert') && 
                massQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('mass_expert');
            }
            
            if (!unlockedAchievements.includes('volume_pro') && 
                volumeQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('volume_pro');
            }

            if (!unlockedAchievements.includes('word_problem_solver') && 
                wordProblemQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('word_problem_solver');
            }
        }

        function showAchievementPopup(achievementId) {
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-popup-header">
                    <span style="font-size: 2em;">🏆</span>
                    <div>
                        <div style="font-weight: bold;">Pencapaian Baru!</div>
                        <div>${achievement.icon} ${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 3000);
        }

        // Question loading
        function loadQuestion() {
            if (currentQuestion >= filteredQuestions.length) {
                showResults();
                return;
            }
            
            // Get question and shuffle its options only
            const originalQ = filteredQuestions[currentQuestion];
            const currentQ = shuffleOptions(originalQ);
            
            document.getElementById('questionText').innerHTML = currentQ.question;
            
            // Update difficulty and points badges
            const difficultyBadge = document.getElementById('difficultyBadge');
            const pointsBadge = document.getElementById('pointsBadge');
            const categoryBadge = document.getElementById('categoryBadge');
            
            const difficultyText = {
                'easy': 'Mudah',
                'medium': 'Sederhana', 
                'hard': 'Sukar'
            };
            
            const pointsText = {
                'easy': '10',
                'medium': '20',
                'hard': '30'
            };

            const categoryText = {
                'measurement_units': 'Unit Ukuran',
                'length_operations': 'Operasi Panjang',
                'mass_operations': 'Operasi Jisim',
                'volume_operations': 'Operasi Isipadu',
                'word_problems': 'Masalah Berayat'
            };
            
            difficultyBadge.textContent = difficultyText[currentQ.difficulty] || 'Sederhana';
            difficultyBadge.className = `difficulty-badge difficulty-${currentQ.difficulty || 'medium'}`;
            pointsBadge.textContent = `${pointsText[currentQ.difficulty] || '20'} mata`;
            categoryBadge.textContent = categoryText[currentQ.category] || 'Matematik';
            
            // Store the current question with shuffled options for answer checking
            window.currentQuestionData = currentQ;
            
            // Load image if present
            loadQuestionImage(currentQ);
            
            // Update options (now shuffled)
            loadOptions(currentQ);
            
            // Reset feedback and buttons
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('actionButtons').innerHTML = 
                '<button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>';
            
            // Start timer
            startTimer();
            updateDisplays();
        }

        function loadQuestionImage(question) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            container.style.display = 'none';
            
            if (question.image) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-container';
                
                if (question.image.src) {
                    const img = document.createElement('img');
                    img.src = question.image.src;
                    img.alt = question.image.alt;
                    img.onerror = function() {
                        imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                    };
                    imageDiv.appendChild(img);
                } else if (question.image.description) {
                    imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                }
                
                container.appendChild(imageDiv);
                container.style.display = 'block';
            }
        }

        function loadOptions(question) {
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-label">Pilihan ${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                btn.dataset.answer = option;
                btn.onclick = () => selectAnswer(option);
                container.appendChild(btn);
            });
        }

        // Answer selection
        function selectAnswer(answer) {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const isCorrect = answer === currentQ.answer;
            const earnedPoints = calculatePoints(currentQ.difficulty, timeLeft, isCorrect);
            
            // Track category performance using original question id
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = isCorrect;
            
            if (isCorrect) {
                const newScore = score + 1;
                const newStreak = streak + 1;
                const newPoints = points + earnedPoints;
                
                score = newScore;
                streak = newStreak;
                points = newPoints;
                bestStreak = Math.max(bestStreak, newStreak);
                
                updateLevel(earnedPoints);
                
                // Check achievements
                if (newScore === 1) checkAchievements('first_correct');
                checkAchievements('streak', newStreak);
                if (timeLeft > 90) checkAchievements('quick_answer');
                checkAchievements('points', newPoints);
                checkAchievements('category_master');
                
                showFeedback(true, earnedPoints, currentQ.explanation);
            } else {
                streak = 0;
                showFeedback(false, 0, `Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            }
            
            highlightAnswers(answer, isCorrect);
            updateDisplays();
            
            // Check for perfect score
            if (currentQuestion === filteredQuestions.length - 1 && isCorrect && score === filteredQuestions.length) {
                checkAchievements('perfect');
            }
        }

        function skipQuestion() {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            streak = 0;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = false;
            
            showFeedback(false, 0, `Soalan dilangkau. Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            highlightCorrectAnswer();
            updateDisplays();
        }

        // Feedback display
        function showFeedback(isCorrect, earnedPoints, explanation) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            feedbackEl.className = `feedback ${isCorrect ? 'correct' : 'wrong'} show`;
            
            const icon = isCorrect ? '✅' : '❌';
            const title = isCorrect ? `Betul! +${earnedPoints} mata!` : 'Tidak betul.';
            const bonus = (isCorrect && timeLeft > 90) ? '<br><span style="color: #ff9800;">⚡ Bonus Pantas!</span>' : '';
            
            feedbackEl.innerHTML = `
                <div class="feedback-header">
                    <span class="feedback-icon">${icon}</span>
                    <span>${title}${bonus}</span>
                </div>
                <div class="feedback-explanation">${explanation}</div>
            `;
            
            // Update action buttons
            const actionButtons = document.getElementById('actionButtons');
            if (currentQuestion < filteredQuestions.length - 1) {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="nextQuestion()">Seterusnya</button>';
            } else {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="showResults()">Selesai</button>';
            }
        }

        // Answer highlighting
        function highlightAnswers(selectedAnswer, isCorrect) {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else if (optionText === selectedAnswer && !isCorrect) {
                    btn.className = 'option-btn wrong';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        function highlightCorrectAnswer() {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        // Navigation
        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // Display updates
        function updateDisplays() {
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${filteredQuestions.length}`;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('pointsDisplay').textContent = points;
            document.getElementById('streakDisplay').textContent = streak;
            document.getElementById('levelDisplay').textContent = level;
            
            const progressPercent = ((currentQuestion + 1) / filteredQuestions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progressPercent}%`;
            progressFill.textContent = `${Math.round(progressPercent)}%`;
            
            const expPercent = ((experience % 100) / 100) * 100;
            const expFill = document.getElementById('expFill');
            expFill.style.width = `${expPercent}%`;
            document.getElementById('expLabel').textContent = `Pengalaman: ${experience} / ${level * 100}`;
        }

        // Results screen
        function showResults() {
            const gameArea = document.getElementById('gameArea');
            const percentage = Math.round((score / filteredQuestions.length) * 100);
            
            let message = '';
            if (percentage === 100) message = 'SEMPURNA! Pakar Panjang, Jisim dan Isipadu! 🧠👑';
            else if (percentage >= 90) message = 'Cemerlang Sekali! 🌟🏆';
            else if (percentage >= 80) message = 'Cemerlang! 🌟';
            else if (percentage >= 70) message = 'Bagus Sekali! 👍✨';
            else if (percentage >= 60) message = 'Bagus! 👍';
            else if (percentage >= 50) message = 'Boleh Tahan! 💪';
            else message = 'Cuba Lagi! Jangan Putus Asa! 🤗';
            
            let achievementsHTML = '';
            if (unlockedAchievements.length > 0) {
                achievementsHTML = `
                    <div class="achievements-section">
                        <h3>🏆 Pencapaian</h3>
                        <div class="achievements-grid">
                            ${unlockedAchievements.map(id => {
                                const achievement = achievementDefinitions.find(a => a.id === id);
                                return achievement ? `
                                    <div class="achievement-badge">
                                        <div class="achievement-icon">${achievement.icon}</div>
                                        <div class="achievement-name">${achievement.name}</div>
                                    </div>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            gameArea.innerHTML = `
                <div class="complete-screen">
                    <div class="trophy-animation">🏆</div>
                    <h2 style="color: #f57f17; margin-bottom: 30px;">Tahniah!</h2>
                    
                    <div class="final-stats">
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #f57f17;">${score}/${filteredQuestions.length}</div>
                            <div class="final-stat-label">Soalan Betul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #8bc34a;">${points}</div>
                            <div class="final-stat-label">Mata Dikumpul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ff9800;">${bestStreak}</div>
                            <div class="final-stat-label">Berturut Terbaik</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ffb300;">${level}</div>
                            <div class="final-stat-label">Tahap Dicapai</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Peratusan: ${percentage}%</div>
                    <div style="font-size: 1.8em; color: #8bc34a; margin-bottom: 30px; font-weight: bold;">${message}</div>
                    
                    ${achievementsHTML}
                    
                    <div class="action-buttons" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="restartGame()" style="font-size: 1.2em; padding: 15px 30px; margin-right: 15px;">
                            🔄 Main Lagi
                        </button>
                        <button class="btn btn-back" onclick="goBack()" style="font-size: 1.2em; padding: 15px 30px;">
                            ← Halaman Utama
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('timerDisplay').style.display = 'none';
        }

        // Game restart
        function restartGame() {
            currentQuestion = 0;
            score = 0;
            points = 0;
            streak = 0;
            level = 1;
            experience = 0;
            unlockedAchievements = [];
            categoryStats = {};
            
            document.getElementById('timerDisplay').style.display = 'block';
            filteredQuestions = [...questions];
            loadQuestion();
        }

        // Navigation functions
        function goBack() {
            window.location.href = '../';
        }

        // Initialize the game
        initGame();
    </script>
</body>
</html>
