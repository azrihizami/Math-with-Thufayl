<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matematik Asas - Math Learning App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffebee 0%, #fce4ec 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .title {
            font-size: 2.5em;
            color: #c62828;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 20px;
        }
        
        .main-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border: 2px solid #ffebee;
        }
        
        .stat-number {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 0.85em;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .experience-bar {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .exp-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
        }
        
        .exp-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #c62828, #e53935);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .category-selector {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .category-select {
            padding: 12px 20px;
            border: 2px solid #c62828;
            border-radius: 8px;
            background: white;
            color: #c62828;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-select:hover {
            background: #c62828;
            color: white;
        }
        
        .progress-section {
            margin-bottom: 30px;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 10px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #c62828, #d32f2f);
            width: 0%;
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .timer-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .timer-fill {
            height: 100%;
            width: 100%;
            transition: all 1s linear;
            background: #4caf50;
        }
        
        .timer-fill.warning {
            background: #ff9800;
        }
        
        .timer-fill.danger {
            background: #f44336;
            animation: pulse-timer 0.5s infinite alternate;
        }
        
        @keyframes pulse-timer {
            from { opacity: 1; }
            to { opacity: 0.7; }
        }
        
        .question-card {
            background: #fafafa;
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            margin-bottom: 20px;
            position: relative;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        
        .question-content {
            flex: 1;
        }
        
        .question-text {
            font-size: 1.2em;
            margin-bottom: 20px;
            color: #333;
            line-height: 1.6;
        }
        
        .image-container {
            background: #f5f5f5;
            border: 2px dashed #ccc;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .image-container img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .image-fallback {
            background: #ffebee;
            padding: 20px;
            border-radius: 8px;
            color: #c62828;
            font-weight: 500;
        }
        
        .difficulty-badges {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-left: 20px;
        }
        
        .difficulty-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            text-align: center;
        }
        
        .difficulty-easy { background: #e8f5e9; color: #2e7d32; }
        .difficulty-medium { background: #fff3e0; color: #f57c00; }
        .difficulty-hard { background: #ffebee; color: #c62828; }
        
        .points-badge {
            background: #ffebee;
            color: #c62828;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .category-badge {
            background: #fce4ec;
            color: #ad1457;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .option-btn {
            padding: 20px;
            border: 2px solid #c62828;
            border-radius: 12px;
            background: #fdf2f2;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
            font-size: 1em;
            position: relative;
            transform-origin: center;
        }
        
        .option-btn:hover:not(:disabled) {
            background: #ffebee;
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 25px rgba(198, 40, 40, 0.15);
        }
        
        .option-label {
            font-size: 0.8em;
            opacity: 0.7;
            margin-bottom: 5px;
        }
        
        .option-text {
            font-size: 1.1em;
            font-weight: 500;
        }
        
        .option-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
            animation: correctPulse 0.6s ease-out;
        }
        
        .option-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: wrongShake 0.5s ease-out;
        }
        
        .option-btn.disabled {
            background: #f0f0f0;
            color: #999;
            border-color: #ddd;
            cursor: not-allowed;
        }
        
        @keyframes correctPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .feedback {
            padding: 25px;
            border-radius: 12px;
            margin-top: 20px;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }
        
        .feedback::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }
        
        .feedback.show::before {
            left: 100%;
        }
        
        .feedback.correct {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            color: #2e7d32;
            border-color: #4caf50;
        }
        
        .feedback.wrong {
            background: linear-gradient(135deg, #ffebee, #ffcdd2);
            color: #c62828;
            border-color: #f44336;
        }
        
        .feedback-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .feedback-icon {
            font-size: 1.5em;
        }
        
        .feedback-explanation {
            font-weight: normal;
            line-height: 1.5;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #c62828, #d32f2f);
            color: white;
            box-shadow: 0 4px 15px rgba(198, 40, 40, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(198, 40, 40, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #757575, #616161);
            color: white;
            box-shadow: 0 4px 15px rgba(117, 117, 117, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(117, 117, 117, 0.4);
        }
        
        .btn-back {
            background: linear-gradient(135deg, #6c757d, #5a6268);
            color: white;
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
            border: 2px solid transparent;
        }
        
        .btn-back:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(108, 117, 125, 0.4);
            border-color: #495057;
        }
        
        .back-button-container {
            position: absolute;
            top: 20px;
            left: 20px;
        }
        
        .timer-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: white;
            padding: 10px 20px;
            border-radius: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            font-weight: bold;
            font-size: 1.1em;
            border: 2px solid #e0e0e0;
            z-index: 1000;
            transition: all 0.3s ease;
        }
        
        .timer-display.warning {
            background: #ff9800;
            color: white;
            border-color: #ff9800;
            animation: pulse 2s infinite;
        }
        
        .timer-display.danger {
            background: #f44336;
            color: white;
            border-color: #f44336;
            animation: urgentPulse 0.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes urgentPulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            25% { transform: scale(1.1) rotate(-2deg); }
            75% { transform: scale(1.1) rotate(2deg); }
        }
        
        .complete-screen {
            text-align: center;
            padding: 50px 20px;
        }
        
        .trophy-animation {
            font-size: 5em;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-30px); }
            60% { transform: translateY(-15px); }
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .final-stat {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .final-stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .final-stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .achievements-section {
            margin-top: 30px;
            text-align: left;
        }
        
        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .achievement-badge {
            background: linear-gradient(135deg, #e57373, #ef5350);
            color: #b71c1c;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #e57373;
            animation: achievementGlow 2s ease-in-out infinite alternate;
        }
        
        @keyframes achievementGlow {
            from { box-shadow: 0 4px 15px rgba(229, 115, 115, 0.3); }
            to { box-shadow: 0 8px 25px rgba(229, 115, 115, 0.6); }
        }
        
        .achievement-icon {
            font-size: 2em;
            margin-bottom: 8px;
        }
        
        .achievement-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .achievement-popup {
            position: fixed;
            top: 70px;
            right: 10px;
            background: #e57373;
            color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(229, 115, 115, 0.4);
            z-index: 1001;
            animation: slideInBounce 0.6s ease-out;
            border: 2px solid #ef5350;
            max-width: 250px;
        }
        
        @keyframes slideInBounce {
            0% { transform: translateX(400px); opacity: 0; }
            60% { transform: translateX(-20px); opacity: 1; }
            100% { transform: translateX(0); }
        }
        
        .achievement-popup-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .action-buttons {
            text-align: center;
            margin-top: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .data-table th {
            background: #c62828;
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .data-table td {
            padding: 15px;
            text-align: center;
            border: 1px solid #ddd;
            font-weight: 500;
        }
        
        .data-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .data-table tr:hover {
            background: #ffebee;
        }

        .fraction {
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            margin: 0 5px;
        }
        
        .fraction .numerator {
            display: block;
            border-bottom: 2px solid #333;
            padding-bottom: 2px;
        }
        
        .fraction .denominator {
            display: block;
            padding-top: 2px;
        }

        .math-expression {
            font-family: 'Times New Roman', serif;
            font-size: 1.3em;
            margin: 10px 0;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
                margin: 5px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .main-stats {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .timer-display {
                position: fixed;
                top: 5px;
                right: 5px;
                padding: 8px 15px;
                font-size: 1em;
                border-radius: 20px;
                box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            }
            
            .achievement-popup {
                top: 55px;
                right: 5px;
                left: 5px;
                max-width: none;
                padding: 12px;
            }
            
            .difficulty-badges {
                flex-direction: row;
                margin-left: 0;
                margin-top: 15px;
            }
            
            .question-header {
                flex-direction: column;
            }
            
            .final-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            body {
                padding: 10px 5px 5px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="timer-display" id="timerDisplay">‚è∞ 2:00</div>
    
    <div class="back-button-container">
        <button class="btn btn-back" onclick="goBack()">
            ‚Üê Kembali
        </button>
    </div>
    
    <div class="container">
        <div class="header">
            <h1 class="title">üí∞ Wang</h1>
            <p class="subtitle">Permainan Matematik Wang Interaktif - Berdasarkan Lembaran Kerja Sebenar</p>
        </div>

        <div class="main-stats">
            <div class="stat-box">
                <div class="stat-number" id="questionCounter" style="color: #c62828;">1/20</div>
                <div class="stat-label">Soalan</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="scoreDisplay" style="color: #d32f2f;">0</div>
                <div class="stat-label">Skor</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="pointsDisplay" style="color: #b71c1c;">0</div>
                <div class="stat-label">Mata</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="streakDisplay" style="color: #ff9800;">0</div>
                <div class="stat-label">Berturut</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="levelDisplay" style="color: #e57373;">1</div>
                <div class="stat-label">Tahap</div>
            </div>
            <div class="stat-box">
                <div class="stat-number" id="timerStat" style="color: #2196f3;">2:00</div>
                <div class="stat-label">Masa</div>
            </div>
        </div>

        <div class="experience-bar">
            <div class="exp-label" id="expLabel">Pengalaman: 0 / 100</div>
            <div class="exp-bar">
                <div class="exp-fill" id="expFill"></div>
            </div>
        </div>

        <div class="progress-section">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">5%</div>
            </div>
            <div class="timer-bar">
                <div class="timer-fill" id="timerBar"></div>
            </div>
        </div>

        <div id="gameArea">
            <div class="question-card">
                <div class="question-header">
                    <div class="question-content">
                        <div class="question-text" id="questionText">
                            Loading question...
                        </div>
                        <div id="imageContainer"></div>
                    </div>
                    <div class="difficulty-badges">
                        <div class="difficulty-badge" id="difficultyBadge">Sederhana</div>
                        <div class="points-badge" id="pointsBadge">20 mata</div>
                        <div class="category-badge" id="categoryBadge">Topik</div>
                    </div>
                </div>
                
                <div class="options" id="optionsContainer">
                    <!-- Options will be populated by JavaScript -->
                </div>

                <div id="feedback" style="display: none;"></div>
                
                <div class="action-buttons" id="actionButtons">
                    <button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // All 20 questions from the worksheet - with randomized answer positions
        const questions = [
            // Short questions (1-10)
            {
                id: 1,
                category: 'money_operations',
                difficulty: 'easy',
                question: 'Kira: RM49 500 + RM18 759.30',
                answer: 'RM68 259.30',
                options: ['RM67 259.30', 'RM68 259.30', 'RM69 259.30', 'RM68 359.30'],
                explanation: 'RM49 500 + RM18 759.30 = RM68 259.30'
            },
            {
                id: 2,
                category: 'money_operations',
                difficulty: 'easy',
                question: 'Kira: RM58 077.40 - RM23 602.50',
                answer: 'RM34 474.90',
                options: ['RM34 474.90', 'RM34 574.90', 'RM35 474.90', 'RM34 464.90'],
                explanation: 'RM58 077.40 - RM23 602.50 = RM34 474.90'
            },
            {
                id: 3,
                category: 'number_operations',
                difficulty: 'medium',
                question: 'Kira: 86 040 √∑ 12 √ó 4',
                answer: '28 680',
                options: ['28 580', '28 680', '28 780', '29 680'],
                explanation: '86 040 √∑ 12 = 7 170, kemudian 7 170 √ó 4 = 28 680'
            },
            {
                id: 4,
                category: 'fractions',
                difficulty: 'medium',
                question: 'Tukar pecahan tak wajar 19/7 kepada nombor bercampur.',
                answer: '2 5/7',
                options: ['2 4/7', '2 5/7', '2 6/7', '3 5/7'],
                explanation: '19 √∑ 7 = 2 baki 5, jadi jawapannya ialah 2 5/7'
            },
            {
                id: 5,
                category: 'fractions',
                difficulty: 'easy',
                question: 'Kira: 4/7 + 5/7',
                answer: '9/7 atau 1 2/7',
                options: ['8/7', '9/7 atau 1 2/7', '10/7', '1 3/7'],
                explanation: 'Penyebut sama, jadi tambah pembilang: 4 + 5 = 9, jawapan = 9/7 = 1 2/7'
            },
            {
                id: 6,
                category: 'decimals',
                difficulty: 'easy',
                question: 'Kira: 6.834 √ó 100',
                answer: '683.4',
                options: ['68.34', '683.4', '6834', '68340'],
                explanation: 'Apabila darab dengan 100, titik perpuluhan bergerak 2 tempat ke kanan: 683.4'
            },
            {
                id: 7,
                category: 'percentages',
                difficulty: 'medium',
                question: 'Kira peratusan bagi 16 biji belon merah daripada 40 biji belon.',
                answer: '40%',
                options: ['30%', '35%', '40%', '45%'],
                explanation: '16 √∑ 40 √ó 100% = 40%'
            },
            {
                id: 8,
                category: 'number_systems',
                difficulty: 'medium',
                question: 'Bundarkan 72 963 kepada ribu terdekat.',
                answer: '73 000',
                options: ['72 000', '72 900', '72 960', '73 000'],
                explanation: 'Lihat digit ratusan (9). Kerana 9 ‚â• 5, bundarkan naik kepada 73 000'
            },
            {
                id: 9,
                category: 'decimals',
                difficulty: 'medium',
                question: 'Kira: 90.874 + 56 + 102.34',
                answer: '249.214',
                options: ['248.214', '249.214', '250.214', '249.314'],
                explanation: '90.874 + 56 + 102.34 = 249.214'
            },
            {
                id: 10,
                category: 'money_operations',
                difficulty: 'medium',
                question: 'Kira: 65 √ó RM900.20',
                answer: 'RM58 513',
                options: ['RM58 413', 'RM58 513', 'RM58 613', 'RM59 513'],
                explanation: '65 √ó RM900.20 = RM58 513'
            },
            
            // Longer word problems with images (11-20)
            {
                id: 11,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Keuntungan Perniagaan Kraf Jaya pada Mei ialah RM12 540.60. Pada Jun, keuntungan meningkat sebanyak RM2 089.85. Hitung jumlah keuntungan pada Mei dan Jun.',
                image: {
                    src: 'images/business-profit-chart.png',
                    alt: 'Carta keuntungan perniagaan Kraf Jaya',
                    description: 'Graf bar menunjukkan keuntungan Mei (RM12,540.60) dan Jun (RM14,630.45) dengan ikon mata wang dan trend naik'
                },
                answer: 'RM27 171.05',
                options: ['RM26 171.05', 'RM27 171.05', 'RM28 171.05', 'RM27 271.05'],
                explanation: 'Keuntungan Jun = RM12 540.60 + RM2 089.85 = RM14 630.45. Jumlah = RM12 540.60 + RM14 630.45 = RM27 171.05'
            },
            {
                id: 12,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Sebuah koperasi mengagihkan sama banyak keuntungan berjumlah RM61 250 kepada 25 orang ahlinya. Kira keuntungan yang diterima oleh Ah Sim dan 7 orang rakannya (total 8 orang).',
                image: {
                    src: 'images/cooperative-distribution.png',
                    alt: 'Pembahagian keuntungan koperasi',
                    description: 'Ilustrasi 25 orang ahli koperasi duduk dalam bulatan dengan wang RM61,250 di tengah, menunjukkan pembahagian sama rata'
                },
                answer: 'RM19 600',
                options: ['RM18 600', 'RM19 600', 'RM20 600', 'RM19 500'],
                explanation: 'Keuntungan setiap orang = RM61 250 √∑ 25 = RM2 450. Untuk 8 orang = RM2 450 √ó 8 = RM19 600'
            },
            {
                id: 13,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Jadual menunjukkan penyata akaun Lim yang tidak lengkap. Wang masuk pada 19.06.2020 ialah RM2 000.00, wang keluar pada 24.07.2020 ialah RM18 500.00, dan wang keluar pada 30.08.2020 ialah RM8 068.99. Berapakah baki akhir wangnya pada 30.08.2020?',
                image: {
                    src: 'images/bank-statement-table.png',
                    alt: 'Penyata akaun bank Lim',
                    description: 'Jadual penyata bank dengan kolum Tarikh, Wang masuk, Wang keluar, dan Baki. Menunjukkan baki awal RM87,691.25'
                },
                answer: 'RM63 122.26',
                options: ['RM62 122.26', 'RM63 122.26', 'RM64 122.26', 'RM63 222.26'],
                explanation: 'Baki = RM87 691.25 + RM2 000.00 - RM18 500.00 - RM8 068.99 = RM63 122.26'
            },
            {
                id: 14,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Ayah meletakkan 80 anak pokok cili pada setiap 3 rak. Setelah dua bulan, anak pokok itu dijual sama banyak kepada 6 orang pembeli. Adakah setiap pembeli mendapat 60 anak pokok?',
                image: {
                    src: 'images/chili-plant-distribution.png',
                    alt: 'Pembahagian anak pokok cili',
                    description: '3 rak dengan 80 anak pokok setiap satu, kemudian 6 orang pembeli menunggu untuk mendapat bahagian mereka'
                },
                answer: 'Tidak, setiap pembeli dapat 40 pokok',
                options: ['Ya, setiap pembeli dapat 60 pokok', 'Tidak, setiap pembeli dapat 40 pokok', 'Tidak, setiap pembeli dapat 50 pokok', 'Ya, setiap pembeli dapat 45 pokok'],
                explanation: 'Jumlah pokok = 80 √ó 3 = 240. Setiap pembeli dapat = 240 √∑ 6 = 40 pokok. Jadi tidak, bukan 60 pokok.'
            },
            {
                id: 15,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Seorang pemborong memasukkan 24 000 biji oren ke dalam beberapa buah kotak. Setiap kotak diisi 96 biji oren. Berapakah bilangan kotak yang diperlukan? Jika pemborong mempunyai 200 buah kotak sahaja, berapakah biji oren dapat diisikan ke dalam sebuah kotak?',
                image: {
                    src: 'images/orange-packaging.png',
                    alt: 'Pembungkusan oren dalam kotak',
                    description: 'Gudang dengan 24,000 biji oren dan kotak-kotak kosong, menunjukkan proses pembungkusan'
                },
                answer: '250 kotak; 120 biji per kotak',
                options: ['240 kotak; 120 biji per kotak', '250 kotak; 120 biji per kotak', '260 kotak; 110 biji per kotak', '250 kotak; 125 biji per kotak'],
                explanation: 'Kotak diperlukan = 24 000 √∑ 96 = 250. Jika 200 kotak, setiap kotak = 24 000 √∑ 200 = 120 biji'
            },
            {
                id: 16,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Berdasarkan perbualan: Din mendapat 18 040 mata, 245 mata lebih daripada Sim. Lan menyatakan jumlah skor mereka bertiga ialah 37 720 mata. Hitung skor Sim dan cari beza antara skor Sim dengan skor Lan.',
                image: {
                    src: 'images/gaming-competition-scores.png',
                    alt: 'Papan skor pertandingan',
                    description: 'Papan skor elektronik menunjukkan 3 pemain dengan Din (18,040), Sim (?), Lan (?) dan jumlah keseluruhan 37,720'
                },
                answer: 'Sim: 17 795; Beza: 1 885',
                options: ['Sim: 17 795; Beza: 1 885', 'Sim: 17 695; Beza: 1 985', 'Sim: 17 895; Beza: 1 785', 'Sim: 17 795; Beza: 1 775'],
                explanation: 'Skor Sim = 18 040 - 245 = 17 795. Skor Lan = 37 720 - 18 040 - 17 795 = 1 885. Beza = 17 795 - 1 885 = 15 910. Tunggu, itu salah. Beza = 1 885 mata (Lan lebih rendah)'
            },
            {
                id: 17,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Gopal, Bakhtiar dan Chong Han menyertai larian obor secara bergilir-gilir sejauh 35 km. Gopal berlari sejauh 12.5 km dan Bakhtiar pula sejauh 10.82 km. Berapakah jarak larian Chong Han?',
                image: {
                    src: 'images/relay-race-torch.png',
                    alt: 'Larian obor bergilir',
                    description: 'Peta larian 35km dengan 3 segmen: Gopal (12.5km), Bakhtiar (10.82km), dan Chong Han (?km). Pelari membawa obor'
                },
                answer: '11.68 km',
                options: ['11.58 km', '11.68 km', '11.78 km', '11.88 km'],
                explanation: 'Jarak Chong Han = 35 - 12.5 - 10.82 = 11.68 km'
            },
            {
                id: 18,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Ibu Wanie ada 2¬Ω kg tepung. Ibu menggunakan ¬º kg tepung untuk membuat cucur udang dan ‚Öï kg untuk membuat kuih donat. Berapakah jisim tepung yang tinggal?',
                image: {
                    src: 'images/flour-cooking-portions.png',
                    alt: 'Penggunaan tepung untuk masakan',
                    description: 'Bekas tepung 2¬Ωkg dengan bahagian digunakan untuk cucur udang (¬ºkg) dan kuih donat (‚Öïkg), menunjukkan baki tepung'
                },
                answer: '2 1/20 kg',
                options: ['2 kg', '2 1/20 kg', '2 1/10 kg', '2 3/20 kg'],
                explanation: 'Tepung digunakan = ¬º + ‚Öï = 5/20 + 4/20 = 9/20 kg. Baki = 2¬Ω - 9/20 = 50/20 - 9/20 = 41/20 = 2 1/20 kg'
            },
            {
                id: 19,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Ayah membuat potongan gaji selama 30 bulan untuk tujuan menabung. Wang tabungan itu akhirnya berjumlah RM10 500. Berapakah jumlah wang yang disimpan oleh ayah setiap bulan?',
                image: {
                    src: 'images/monthly-savings-plan.png',
                    alt: 'Pelan simpanan bulanan',
                    description: 'Kalendar 30 bulan dengan setiap bulan menunjukkan jumlah wang yang sama disimpan, berujung dengan target RM10,500'
                },
                answer: 'RM350 sebulan',
                options: ['RM300 sebulan', 'RM350 sebulan', 'RM400 sebulan', 'RM450 sebulan'],
                explanation: 'Wang setiap bulan = RM10 500 √∑ 30 = RM350'
            },
            {
                id: 20,
                category: 'word_problems',
                difficulty: 'hard',
                question: 'Wafiq membeli 10.2 kg buah langsat. Dia memberikan sebahagian kepada jirannya. Jisim buah langsat yang tinggal ialah 3.8 kg. Baki buah langsat itu diikat kepada 8 ikat yang sama jisim. Berapakah jisim buah langsat yang diberikan kepada jiran? Berapakah jisim seikat buah langsat?',
                image: {
                    src: 'images/langsat-fruit-distribution.png',
                    alt: 'Pembahagian buah langsat',
                    description: 'Wafiq dengan 10.2kg buah langsat, memberikan sebahagian kepada jiran, kemudian membahagi baki 3.8kg kepada 8 ikat'
                },
                answer: '6.4 kg; 0.475 kg per ikat',
                options: ['6.4 kg; 0.475 kg per ikat', '6.5 kg; 0.48 kg per ikat', '6.3 kg; 0.47 kg per ikat', '6.4 kg; 0.48 kg per ikat'],
                explanation: 'Diberi kepada jiran = 10.2 - 3.8 = 6.4 kg. Seikat = 3.8 √∑ 8 = 0.475 kg'
            }
        ];

        // Achievement definitions
        const achievementDefinitions = [
            { id: 'first_correct', name: 'Permulaan Hebat!', description: 'Jawab soalan pertama dengan betul', icon: 'üåü' },
            { id: 'streak_3', name: 'Dalam Rentak!', description: 'Jawab 3 soalan berturut-turut dengan betul', icon: 'üî•' },
            { id: 'streak_5', name: 'Hebat Sungguh!', description: 'Jawab 5 soalan berturut-turut dengan betul', icon: '‚ö°' },
            { id: 'quick_thinker', name: 'Pemikir Pantas!', description: 'Jawab dalam 10 saat', icon: 'üí®' },
            { id: 'level_2', name: 'Naik Tahap!', description: 'Capai tahap 2', icon: 'üéØ' },
            { id: 'level_3', name: 'Pakar Matematik!', description: 'Capai tahap 3', icon: 'üëë' },
            { id: 'perfect_score', name: 'Sempurna!', description: 'Dapatkan 100% markah', icon: 'üèÜ' },
            { id: 'high_scorer', name: 'Pencapai Tinggi!', description: 'Kumpul 500+ mata', icon: 'üíé' },
            { id: 'money_master', name: 'Pakar Wang!', description: 'Jawab semua soalan wang dengan betul', icon: 'üí∞' },
            { id: 'calculation_expert', name: 'Ahli Pengiraan!', description: 'Jawab semua soalan operasi dengan betul', icon: 'üßÆ' },
            { id: 'fraction_pro', name: 'Pro Pecahan!', description: 'Jawab semua soalan pecahan dengan betul', icon: 'üî¢' },
            { id: 'word_problem_solver', name: 'Penyelesai Masalah!', description: 'Jawab semua masalah berayat dengan betul', icon: 'üìù' }
        ];

        // Game state
        let currentQuestion = 0;
        let score = 0;
        let points = 0;
        let streak = 0;
        let bestStreak = 0;
        let level = 1;
        let experience = 0;
        let timeLeft = 30;
        let timerInterval;
        let gameActive = true;
        let unlockedAchievements = [];
        let filteredQuestions = [];
        let categoryStats = {};

        // Shuffle array function for options only
        function shuffleOptions(question) {
            const correctAnswer = question.answer;
            const shuffledOptions = [...question.options];
            
            // Shuffle the options array
            for (let i = shuffledOptions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledOptions[i], shuffledOptions[j]] = [shuffledOptions[j], shuffledOptions[i]];
            }
            
            return {
                ...question,
                options: shuffledOptions,
                answer: correctAnswer // Keep the correct answer unchanged
            };
        }

        // Initialize game
        function initGame() {
            console.log('Initializing game...');
            console.log('Questions array length:', questions.length);
            
            // Always use all questions, no filtering
            filteredQuestions = [...questions];
            console.log('Filtered questions length:', filteredQuestions.length);
            
            if (filteredQuestions.length > 0) {
                loadQuestion();
                startTimer();
                updateDisplays();
            } else {
                console.error('No questions available!');
            }
        }

        // Timer functions
        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120; // 2 minutes
            gameActive = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('timerDisplay');
            const timerBar = document.getElementById('timerBar');
            const timerStat = document.getElementById('timerStat');
            
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            const timeText = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            timerEl.textContent = `‚è∞ ${timeText}`;
            timerStat.textContent = timeText;
            timerBar.style.width = `${(timeLeft / 120) * 100}%`;
            
            if (timeLeft <= 10) {
                timerEl.className = 'timer-display danger';
                timerBar.className = 'timer-fill danger';
                timerStat.style.color = '#f44336';
            } else if (timeLeft <= 30) {
                timerEl.className = 'timer-display warning';
                timerBar.className = 'timer-fill warning';
                timerStat.style.color = '#ff9800';
            } else {
                timerEl.className = 'timer-display';
                timerBar.className = 'timer-fill';
                timerStat.style.color = '#2196f3';
            }
        }

        // Points calculation
        function calculatePoints(difficulty, timeRemaining, isCorrect) {
            if (!isCorrect) return 0;
            
            let basePoints = 0;
            switch (difficulty) {
                case 'easy': basePoints = 10; break;
                case 'medium': basePoints = 20; break;
                case 'hard': basePoints = 30; break;
                default: basePoints = 15;
            }
            
            let timeBonus = timeRemaining > 60 ? 10 : timeRemaining > 30 ? 5 : 0;
            let streakMultiplier = Math.min(streak + 1, 3);
            
            return Math.round((basePoints + timeBonus) * streakMultiplier);
        }

        // Level and experience
        function updateLevel(newPoints) {
            const newExperience = experience + newPoints;
            const newLevel = Math.floor(newExperience / 100) + 1;
            
            if (newLevel > level) {
                checkAchievements('level', newLevel);
                showLevelUp(newLevel);
            }
            
            experience = newExperience;
            level = newLevel;
        }

        function showLevelUp(newLevel) {
            const levelEl = document.getElementById('levelDisplay');
            levelEl.style.animation = 'bounce 1s ease-out';
            setTimeout(() => {
                levelEl.style.animation = '';
            }, 1000);
        }

        // Achievement system
        function checkAchievements(type, value) {
            const newAchievements = [];
            
            switch (type) {
                case 'first_correct':
                    if (score === 0 && !unlockedAchievements.includes('first_correct')) {
                        newAchievements.push('first_correct');
                    }
                    break;
                case 'streak':
                    if (value >= 3 && !unlockedAchievements.includes('streak_3')) newAchievements.push('streak_3');
                    if (value >= 5 && !unlockedAchievements.includes('streak_5')) newAchievements.push('streak_5');
                    break;
                case 'quick_answer':
                    if (timeLeft > 90 && !unlockedAchievements.includes('quick_thinker')) {
                        newAchievements.push('quick_thinker');
                    }
                    break;
                case 'level':
                    if (value >= 2 && !unlockedAchievements.includes('level_2')) newAchievements.push('level_2');
                    if (value >= 3 && !unlockedAchievements.includes('level_3')) newAchievements.push('level_3');
                    break;
                case 'points':
                    if (value >= 500 && !unlockedAchievements.includes('high_scorer')) {
                        newAchievements.push('high_scorer');
                    }
                    break;
                case 'perfect':
                    if (!unlockedAchievements.includes('perfect_score')) {
                        newAchievements.push('perfect_score');
                    }
                    break;
                case 'category_master':
                    checkCategoryMaster(newAchievements);
                    break;
            }
            
            if (newAchievements.length > 0) {
                unlockedAchievements.push(...newAchievements);
                showAchievementPopup(newAchievements[0]);
            }
        }

        function checkCategoryMaster(newAchievements) {
            const moneyQuestions = questions.filter(q => q.category === 'money_operations');
            const calculationQuestions = questions.filter(q => q.category === 'number_operations');
            const fractionQuestions = questions.filter(q => q.category === 'fractions');
            const wordProblemQuestions = questions.filter(q => q.category === 'word_problems');
            
            if (!unlockedAchievements.includes('money_master') && 
                moneyQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('money_master');
            }
            
            if (!unlockedAchievements.includes('calculation_expert') && 
                calculationQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('calculation_expert');
            }
            
            if (!unlockedAchievements.includes('fraction_pro') && 
                fractionQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('fraction_pro');
            }

            if (!unlockedAchievements.includes('word_problem_solver') && 
                wordProblemQuestions.every(q => categoryStats[q.id] === true)) {
                newAchievements.push('word_problem_solver');
            }
        }

        function showAchievementPopup(achievementId) {
            const achievement = achievementDefinitions.find(a => a.id === achievementId);
            if (!achievement) return;

            const popup = document.createElement('div');
            popup.className = 'achievement-popup';
            popup.innerHTML = `
                <div class="achievement-popup-header">
                    <span style="font-size: 2em;">üèÜ</span>
                    <div>
                        <div style="font-weight: bold;">Pencapaian Baru!</div>
                        <div>${achievement.icon} ${achievement.name}</div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(popup);
            
            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 3000);
        }

        // Question loading
        function loadQuestion() {
            if (currentQuestion >= filteredQuestions.length) {
                showResults();
                return;
            }
            
            // Get question and shuffle its options only
            const originalQ = filteredQuestions[currentQuestion];
            const currentQ = shuffleOptions(originalQ);
            
            // Format question with subquestions if available
            let questionHTML = currentQ.question;
            if (currentQ.subquestions) {
                questionHTML += '<br><br>';
                currentQ.subquestions.forEach(subq => {
                    questionHTML += subq + '<br>';
                });
            }
            
            document.getElementById('questionText').innerHTML = questionHTML;
            
            // Update difficulty and points badges
            const difficultyBadge = document.getElementById('difficultyBadge');
            const pointsBadge = document.getElementById('pointsBadge');
            const categoryBadge = document.getElementById('categoryBadge');
            
            const difficultyText = {
                'easy': 'Mudah',
                'medium': 'Sederhana', 
                'hard': 'Sukar'
            };
            
            const pointsText = {
                'easy': '10',
                'medium': '20',
                'hard': '30'
            };

            const categoryText = {
                'money_operations': 'Operasi Wang',
                'number_operations': 'Operasi Nombor',
                'fractions': 'Pecahan',
                'decimals': 'Perpuluhan',
                'percentages': 'Peratus',
                'number_systems': 'Sistem Nombor',
                'word_problems': 'Masalah Berayat'
            };
            
            difficultyBadge.textContent = difficultyText[currentQ.difficulty] || 'Sederhana';
            difficultyBadge.className = `difficulty-badge difficulty-${currentQ.difficulty || 'medium'}`;
            pointsBadge.textContent = `${pointsText[currentQ.difficulty] || '20'} mata`;
            categoryBadge.textContent = categoryText[currentQ.category] || 'Matematik';
            
            // Store the current question with shuffled options for answer checking
            window.currentQuestionData = currentQ;
            
            // Load image if present
            loadQuestionImage(currentQ);
            
            // Update options (now shuffled)
            loadOptions(currentQ);
            
            // Reset feedback and buttons
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('actionButtons').innerHTML = 
                '<button class="btn btn-secondary" onclick="skipQuestion()">Langkau Soalan</button>';
            
            // Start timer
            startTimer();
            updateDisplays();
        }

        function loadQuestionImage(question) {
            const container = document.getElementById('imageContainer');
            container.innerHTML = '';
            container.style.display = 'none';
            
            if (question.image) {
                const imageDiv = document.createElement('div');
                imageDiv.className = 'image-container';
                
                if (question.image.src) {
                    const img = document.createElement('img');
                    img.src = question.image.src;
                    img.alt = question.image.alt;
                    img.onerror = function() {
                        imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                    };
                    imageDiv.appendChild(img);
                } else if (question.image.description) {
                    imageDiv.innerHTML = `<div class="image-fallback">${question.image.description}</div>`;
                }
                
                container.appendChild(imageDiv);
                container.style.display = 'block';
            }
        }

        function loadOptions(question) {
            const container = document.getElementById('optionsContainer');
            container.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerHTML = `
                    <div class="option-label">Pilihan ${String.fromCharCode(65 + index)}</div>
                    <div class="option-text">${option}</div>
                `;
                btn.dataset.answer = option;
                btn.onclick = () => selectAnswer(option);
                container.appendChild(btn);
            });
        }

        // Answer selection
        function selectAnswer(answer) {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const isCorrect = answer === currentQ.answer;
            const earnedPoints = calculatePoints(currentQ.difficulty, timeLeft, isCorrect);
            
            // Track category performance using original question id
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = isCorrect;
            
            if (isCorrect) {
                const newScore = score + 1;
                const newStreak = streak + 1;
                const newPoints = points + earnedPoints;
                
                score = newScore;
                streak = newStreak;
                points = newPoints;
                bestStreak = Math.max(bestStreak, newStreak);
                
                updateLevel(earnedPoints);
                
                // Check achievements
                if (newScore === 1) checkAchievements('first_correct');
                checkAchievements('streak', newStreak);
                if (timeLeft > 90) checkAchievements('quick_answer');
                checkAchievements('points', newPoints);
                checkAchievements('category_master');
                
                showFeedback(true, earnedPoints, currentQ.explanation);
            } else {
                streak = 0;
                showFeedback(false, 0, `Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            }
            
            highlightAnswers(answer, isCorrect);
            updateDisplays();
            
            // Check for perfect score
            if (currentQuestion === filteredQuestions.length - 1 && isCorrect && score === filteredQuestions.length) {
                checkAchievements('perfect');
            }
        }

        function skipQuestion() {
            if (!gameActive) return;
            
            clearInterval(timerInterval);
            gameActive = false;
            streak = 0;
            
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            const originalQ = filteredQuestions[currentQuestion];
            categoryStats[originalQ.id] = false;
            
            showFeedback(false, 0, `Soalan dilangkau. Jawapan yang betul: ${currentQ.answer}. ${currentQ.explanation}`);
            highlightCorrectAnswer();
            updateDisplays();
        }

        // Feedback display
        function showFeedback(isCorrect, earnedPoints, explanation) {
            const feedbackEl = document.getElementById('feedback');
            feedbackEl.style.display = 'block';
            feedbackEl.className = `feedback ${isCorrect ? 'correct' : 'wrong'} show`;
            
            const icon = isCorrect ? '‚úÖ' : '‚ùå';
            const title = isCorrect ? `Betul! +${earnedPoints} mata!` : 'Tidak betul.';
            const bonus = (isCorrect && timeLeft > 90) ? '<br><span style="color: #ff9800;">‚ö° Bonus Pantas!</span>' : '';
            
            feedbackEl.innerHTML = `
                <div class="feedback-header">
                    <span class="feedback-icon">${icon}</span>
                    <span>${title}${bonus}</span>
                </div>
                <div class="feedback-explanation">${explanation}</div>
            `;
            
            // Update action buttons
            const actionButtons = document.getElementById('actionButtons');
            if (currentQuestion < filteredQuestions.length - 1) {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="nextQuestion()">Seterusnya</button>';
            } else {
                actionButtons.innerHTML = '<button class="btn btn-primary" onclick="showResults()">Selesai</button>';
            }
        }

        // Answer highlighting
        function highlightAnswers(selectedAnswer, isCorrect) {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else if (optionText === selectedAnswer && !isCorrect) {
                    btn.className = 'option-btn wrong';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        function highlightCorrectAnswer() {
            const options = document.querySelectorAll('.option-btn');
            const currentQ = window.currentQuestionData || filteredQuestions[currentQuestion];
            
            options.forEach((btn, index) => {
                btn.disabled = true;
                const optionText = currentQ.options[index];
                
                if (optionText === currentQ.answer) {
                    btn.className = 'option-btn correct';
                } else {
                    btn.className = 'option-btn disabled';
                }
            });
        }

        // Navigation
        function nextQuestion() {
            currentQuestion++;
            loadQuestion();
        }

        // Display updates
        function updateDisplays() {
            document.getElementById('questionCounter').textContent = `${currentQuestion + 1}/${filteredQuestions.length}`;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('pointsDisplay').textContent = points;
            document.getElementById('streakDisplay').textContent = streak;
            document.getElementById('levelDisplay').textContent = level;
            
            const progressPercent = ((currentQuestion + 1) / filteredQuestions.length) * 100;
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = `${progressPercent}%`;
            progressFill.textContent = `${Math.round(progressPercent)}%`;
            
            const expPercent = ((experience % 100) / 100) * 100;
            const expFill = document.getElementById('expFill');
            expFill.style.width = `${expPercent}%`;
            document.getElementById('expLabel').textContent = `Pengalaman: ${experience} / ${level * 100}`;
        }

        // Results screen
        function showResults() {
            const gameArea = document.getElementById('gameArea');
            const percentage = Math.round((score / filteredQuestions.length) * 100);
            
            let message = '';
            if (percentage === 100) message = 'SEMPURNA! Pakar Wang! üí∞üëë';
            else if (percentage >= 90) message = 'Cemerlang Sekali! üåüüèÜ';
            else if (percentage >= 80) message = 'Cemerlang! üåü';
            else if (percentage >= 70) message = 'Bagus Sekali! üëç‚ú®';
            else if (percentage >= 60) message = 'Bagus! üëç';
            else if (percentage >= 50) message = 'Boleh Tahan! üí™';
            else message = 'Cuba Lagi! Jangan Putus Asa! ü§ó';
            
            let achievementsHTML = '';
            if (unlockedAchievements.length > 0) {
                achievementsHTML = `
                    <div class="achievements-section">
                        <h3>üèÜ Pencapaian</h3>
                        <div class="achievements-grid">
                            ${unlockedAchievements.map(id => {
                                const achievement = achievementDefinitions.find(a => a.id === id);
                                return achievement ? `
                                    <div class="achievement-badge">
                                        <div class="achievement-icon">${achievement.icon}</div>
                                        <div class="achievement-name">${achievement.name}</div>
                                    </div>
                                ` : '';
                            }).join('')}
                        </div>
                    </div>
                `;
            }
            
            gameArea.innerHTML = `
                <div class="complete-screen">
                    <div class="trophy-animation">üèÜ</div>
                    <h2 style="color: #c62828; margin-bottom: 30px;">Tahniah!</h2>
                    
                    <div class="final-stats">
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #c62828;">${score}/${filteredQuestions.length}</div>
                            <div class="final-stat-label">Soalan Betul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #d32f2f;">${points}</div>
                            <div class="final-stat-label">Mata Dikumpul</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #ff9800;">${bestStreak}</div>
                            <div class="final-stat-label">Berturut Terbaik</div>
                        </div>
                        <div class="final-stat">
                            <div class="final-stat-number" style="color: #e57373;">${level}</div>
                            <div class="final-stat-label">Tahap Dicapai</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 1.2em; margin-bottom: 10px;">Peratusan: ${percentage}%</div>
                    <div style="font-size: 1.8em; color: #d32f2f; margin-bottom: 30px; font-weight: bold;">${message}</div>
                    
                    ${achievementsHTML}
                    
                    <div class="action-buttons" style="margin-top: 40px;">
                        <button class="btn btn-primary" onclick="restartGame()" style="font-size: 1.2em; padding: 15px 30px; margin-right: 15px;">
                            üîÑ Main Lagi
                        </button>
                        <button class="btn btn-back" onclick="goBack()" style="font-size: 1.2em; padding: 15px 30px;">
                            ‚Üê Halaman Utama
                        </button>
                    </div>
                </div>
            `;
            
            document.getElementById('timerDisplay').style.display = 'none';
        }

        // Game restart
        function restartGame() {
            currentQuestion = 0;
            score = 0;
            points = 0;
            streak = 0;
            level = 1;
            experience = 0;
            unlockedAchievements = [];
            categoryStats = {};
            
            document.getElementById('timerDisplay').style.display = 'block';
            filteredQuestions = [...questions];
            loadQuestion();
        }

        // Navigation functions
        function goBack() {
            window.location.href = '../';
        }

        // Initialize the game
        initGame();
    </script>
</body>
</html>
